# ä¼ ç»Ÿéƒ¨ç½²æ–¹æ¡ˆ

## éƒ¨ç½²æ¦‚å¿µ

> éƒ¨ç½²â€æ˜¯å°†ä¸€ä¸ªå¼€å‘â€å®Œæˆçš„è½¯ä»¶æˆ–åº”ç”¨ç¨‹â€åºä»å¼€å‘ç¯å¢ƒâ€è½¬ç§»åˆ°ç”Ÿäº§â€ç¯å¢ƒï¼ˆå³æœ€ç»ˆè¿è¡Œç¯â€å¢ƒï¼‰çš„è¿‡ç¨‹ã€‚éƒ¨ç½²â€çš„ç›®æ ‡æ˜¯è®©â€åº”ç”¨ç¨‹åºèƒ½â€å¤Ÿç¨³å®šã€é«˜æ•ˆåœ°ä¸ºç”¨â€æˆ·æˆ–å®¢æˆ·æä¾›æœåŠ¡ã€‚â€éƒ¨ç½²ä¸ä»…ä»…æ˜¯å°†ä»£â€ç ä¸Šä¼ åˆ°æœåŠ¡å™¨é‚£ä¹ˆâ€ç®€å•ï¼Œè¿˜æ¶‰â€åŠåˆ°ç¯å¢ƒé…ç½®ã€â€ä¾èµ–ç®¡ç†ã€å®‰å…¨æ€§è®¾ç½®â€ã€æ€§èƒ½ä¼˜åŒ–ç­‰ä¸€â€ç³»åˆ—æ“ä½œâ€ã€‚
>

è¿™é‡Œçš„â€œéƒ¨ç½²â€æŒ‡çš„æ˜¯åœ¨å…¬ç½‘ç¯å¢ƒä¸‹éƒ¨ç½²ã€‚

åœ¨å¼€å‘é˜¶æ®µï¼Œä»£ç é€šå¸¸æ˜¯è¿è¡Œåœ¨æœ¬åœ°çš„ä¸»æœºä¸Šé¢ï¼Œæœ¬åœ°è¿è¡Œçš„æ–¹å¼ä¹Ÿå«éƒ¨ç½²ã€‚ä¾‹å¦‚å‰ç«¯è¿è¡Œä¸€ä¸ª Vue3 é¡¹ç›®ï¼š`npm run dev`ï¼Œåç«¯è¿è¡Œä¸€ä¸ª FastAPI çš„é¡¹ç›®ï¼š`uvicorn main:app`ã€‚è¿™äº›å‘½ä»¤éƒ½ä¼šåœ¨æœ¬åœ°ä¸»æœºä¸Šå¯åŠ¨ä¸€ä¸ª Web æœåŠ¡å™¨å¹¶ç›‘å¬ç›¸åº”çš„ç«¯å£æ¥æ¥æ”¶è¯·æ±‚ï¼Œè¿™äº›å‘½ä»¤é€‚ç”¨äºä¸åœ¨å¼€å‘ç¯å¢ƒéƒ¨ç½²é¡¹ç›®ã€‚

è€Œè¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²ä¸€ä¸ªé¡¹ç›®ï¼Œç›®çš„åŒæ ·æ˜¯å¯åŠ¨ä¸€ä¸ª Web æœåŠ¡å™¨å¹¶ç›‘å¬ç›¸åº”çš„ç«¯å£æ¥å¤„ç†è¯·æ±‚ï¼Œåªä¸è¿‡å¾ˆå¤§ç¨‹åº¦ä¸Šä¸ä¼šç›´æ¥ä½¿ç”¨è¿™äº›å‘½ä»¤æ¥å¯åŠ¨é¡¹ç›®ã€‚å¦‚æœç›´æ¥ä½¿ç”¨è¿™äº›å‘½ä»¤æ¥åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ç›¸åº”çš„é¡¹ç›®ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šé€ æˆä»¥ä¸‹é—®é¢˜ï¼š

1. è¿›ç¨‹ç®¡ç†å›°éš¾

   å½“ç›´æ¥ä½¿ç”¨è¿™äº›å‘½ä»¤æ¥å¯åŠ¨é¡¹ç›®çš„æ—¶å€™ï¼Œå¦‚æœå°†ç»ˆç«¯å…³é—­äº†ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½è¿™ä¸ªè¿›ç¨‹ä¹Ÿä¼šè¢«å…³é—­ï¼Œå³ä½¿æ²¡æœ‰è¢«å…³é—­ï¼Œé‚£ä¹ˆåç»­ä¹Ÿå¾ˆéš¾ç›‘æ§åˆ°è¿™äº›è¿›ç¨‹çš„çŠ¶æ€ã€æ—¥å¿—ç­‰ç­‰ä¿¡æ¯ã€‚å¹¶ä¸”å¦‚æœä¸€ä¸ªè¿›ç¨‹æŒ‚äº†ï¼Œé‚£ä¹ˆå®ƒä¹Ÿä¸ä¼šè‡ªåŠ¨é‡å¯ã€‚

2. èµ„æºå ç”¨é«˜

   ç›´æ¥åœ¨å‰å°è¿è¡ŒæœåŠ¡æ—¶ï¼Œè¿›ç¨‹çš„èµ„æºä½¿ç”¨ç¼ºä¹è‡ªåŠ¨ç›‘æ§å’Œè°ƒæ§æœºåˆ¶ã€‚å½“æµé‡çªå¢æ—¶ï¼ŒæœåŠ¡å®¹æ˜“å› èµ„æºè€—å°½ï¼ˆå¦‚å†…å­˜ã€CPUï¼‰è€Œå´©æºƒï¼›ç›¸åï¼Œåœ¨ä½è´Ÿè½½æ—¶ä¹Ÿæ— æ³•è‡ªåŠ¨é‡Šæ”¾èµ„æºã€‚åŒæ—¶ï¼Œæ— æ³•å®ç°é›¶åœæœºçš„æ»šåŠ¨æ›´æ–°æˆ–å¤šå®ä¾‹è´Ÿè½½å‡è¡¡ã€‚

3. å®‰å…¨æ€§é£é™©

   ç›´æ¥ä»¥å‘½ä»¤è¡Œå¯åŠ¨æ—¶ï¼ŒæœåŠ¡é€šå¸¸ä»¥å½“å‰ç”¨æˆ·æƒé™è¿è¡Œï¼Œå¯èƒ½å­˜åœ¨æƒé™è¿‡é«˜çš„é—®é¢˜ã€‚æ­¤å¤–ï¼Œé…ç½®ï¼ˆå¦‚ç«¯å£ã€å¯†é’¥ï¼‰å¸¸ä»¥æ˜æ–‡å‚æ•°ä¼ é€’ï¼Œæ˜“æ³„éœ²æ•æ„Ÿä¿¡æ¯ã€‚ç”Ÿäº§ç¯å¢ƒéœ€è¦éš”ç¦»çš„è¿è¡Œç¯å¢ƒï¼ˆå¦‚å®¹å™¨æˆ–æ²™ç®±ï¼‰å’Œå®‰å…¨çš„é…ç½®ç®¡ç†æœºåˆ¶ã€‚

4. è¿ç»´å¤æ‚åº¦é«˜

   ç¼ºå°‘æœåŠ¡å‘ç°ã€å¥åº·æ£€æŸ¥ã€é›†ä¸­åŒ–æ—¥å¿—æ”¶é›†ç­‰åŸºç¡€è®¾æ–½ã€‚å½“æœåŠ¡å¢å¤šæ—¶ï¼Œæ‰‹åŠ¨ç®¡ç†ç«¯å£å†²çªã€ä¾èµ–å¯åŠ¨é¡ºåºç­‰ä¼šå˜å¾—æå…¶å›°éš¾ï¼Œä¸”éš¾ä»¥ä¸ç°æœ‰ç›‘æ§å‘Šè­¦ç³»ç»Ÿé›†æˆã€‚

å› æ­¤åœ¨éƒ¨ç½²é˜¶æ®µä¼šå§”æ‰˜ä¸“é—¨çš„è¿›ç¨‹ç®¡ç†å·¥å…·æ¥å¯åŠ¨è¿™äº›é¡¹ç›®ï¼Œä¾‹å¦‚ Dockerã€Supervisorã€Gunicorn ç­‰ç­‰ã€‚å¹¶ä¸”è¿˜ä¼šä½¿ç”¨ Nginx æ¥é…ç½®åå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡æ¥å®ç°é«˜å¯ç”¨æ€§ã€‚

## é¡¹ç›®æ¶æ„
### ä»£ç ä»“åº“
1. å®¢æˆ·ç«¯ä»£ç ä»“åº“ï¼š[https://github.com/SmartOnlineJudge/smartoj-client](https://github.com/SmartOnlineJudge/smartoj-client)
2. åå°ç®¡ç†ç³»ç»Ÿä»£ç ä»“åº“ï¼š[https://github.com/SmartOnlineJudge/smartoj-management](https://github.com/SmartOnlineJudge/smartoj-management)
3. åç«¯ä»£ç ä»“åº“ï¼š[https://github.com/SmartOnlineJudge/smartoj-backend](https://github.com/SmartOnlineJudge/smartoj-backend)
4. AI æœåŠ¡ä»£ç ä»“åº“ï¼š[https://github.com/SmartOnlineJudge/smartoj-ai-service](https://github.com/SmartOnlineJudge/smartoj-ai-service)
5. åˆ¤é¢˜æ²™ç®±ä»£ç ä»“åº“ï¼š[https://github.com/SmartOnlineJudge/smartoj-codesandbox](https://github.com/SmartOnlineJudge/smartoj-codesandbox)
6. MCP Server ä»£ç ä»“åº“ï¼š[https://github.com/SmartOnlineJudge/smartoj-mcp-server](https://github.com/SmartOnlineJudge/smartoj-mcp-server)

éƒ¨ç½²é¡ºåºï¼šåˆ¤é¢˜æ²™ç®± -> åç«¯ ->  MCP Server  -> AI æœåŠ¡ -> åå°ç®¡ç†ç³»ç»Ÿ -> å®¢æˆ·ç«¯ã€‚

### æ¶æ„å›¾
![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766987675861-0ec3fe2a-cba9-48cd-9043-0d281d5dfc06.png)

## éƒ¨ç½²ç¯å¢ƒå‡†å¤‡
### æœåŠ¡å™¨å‡†å¤‡
å‡†å¤‡ä¸€å°å†…å­˜è‡³å°‘ 4GB å¹¶ä¸”æºå¸¦äº†å…¬ç½‘ IP çš„æœåŠ¡å™¨ï¼Œå› ä¸ºé¡¹ç›®ä¸­ç”¨åˆ°äº†éå¸¸å¤šçš„æ•°æ®åº“ï¼Œè¿™äº›æ•°æ®åº“ä¼šå ç”¨æ‰å¾ˆå¤šå†…å­˜ï¼Œå°¤å…¶æ˜¯ ElasticSearchï¼Œå°†ä¼šå ç”¨æ‰å·®ä¸å¤š 1GB çš„å†…å­˜ã€‚

æœåŠ¡å™¨å¯ä»¥åˆ°è…¾è®¯äº‘æˆ–è€…é˜¿é‡Œäº‘ä¸Šé¢è´­ä¹°ï¼Œä¸€èˆ¬æ–°ç”¨æˆ·æˆ–è€…å­¦ç”Ÿéƒ½ä¼šå¾ˆä¾¿å®œã€‚

ä½¿ç”¨ä»¥ä¸‹è¿™å°æœåŠ¡å™¨æ¥ä½œä¸ºéƒ¨ç½²ç¯å¢ƒçš„å®¿ä¸»æœºï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766988506721-36ca0b32-972a-461f-8469-68c2a3b08d2b.png)

### è¿ç»´é¢æ¿å®‰è£…
> åœ¨ä¸ºæœåŠ¡å™¨å®‰è£…æ“ä½œç³»ç»Ÿçš„æ—¶å€™ï¼Œå¦‚æœè¿è¥å•†æ”¯æŒï¼Œä½ ä¹Ÿå¯ä»¥é¡ºä¾¿é€‰æ‹©å®‰è£…è¿ç»´é¢æ¿ã€‚
>

åœ¨ç›¸å…³è¿è¥å•†çš„æœåŠ¡å™¨æ§åˆ¶é¢æ¿ä¸­å®‰è£…å¥½ç›¸åº”çš„æ“ä½œç³»ç»Ÿï¼Œè¿™é‡Œé€‰æ‹©çš„æ˜¯ Ubuntu é•œåƒã€‚

ä¸ºäº†ç®€åŒ–éƒ¨ç½²æµç¨‹ï¼Œåœ¨éƒ¨ç½²ä¹‹å‰æ¨èå®‰è£…ä¸€ä¸ªå¯è§†åŒ–çš„æœåŠ¡å™¨è¿ç»´é¢æ¿ï¼Œæœ‰äº†å¯è§†åŒ–ç•Œé¢ï¼Œå¯ä»¥å‡å°‘çº¯å‘½ä»¤è¡Œçš„ä½¿ç”¨ï¼Œä»¥æ­¤æ¥æé«˜éƒ¨ç½²çš„å¤æ‚åº¦ã€‚

æœ€å¸¸ç”¨çš„æœåŠ¡å™¨è¿ç»´é¢æ¿æœ‰ï¼š`å®å¡”`å’Œ`1Panel`ã€‚

ç”±äºé¡¹ç›®ä¸­çš„éƒ¨åˆ†æœåŠ¡éœ€è¦ä½¿ç”¨ Docker æ¥éƒ¨ç½²ï¼Œå› æ­¤è¿™é‡Œä¼˜å…ˆé€‰æ‹© 1Panel é¢æ¿æ¥ä½œä¸ºè¿ç»´é¢æ¿ã€‚

åœ¨æœåŠ¡å™¨è¿è¥å•†çš„æ§åˆ¶å°ä¸­ç™»å½•åˆ°æœåŠ¡å™¨ç»ˆç«¯ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766988793212-395dbd25-ed70-4d34-a076-16c89e8751ea.png)

ä¸‹é¢å°±æ˜¯è¾“å…¥å‘½ä»¤å®‰è£…é¢æ¿äº†ã€‚

> å®˜æ–¹æ–‡æ¡£ï¼š[https://1panel.cn/docs/v1/installation/online_installation/](https://1panel.cn/docs/v1/installation/online_installation/)
>

é¦–å…ˆç¡®è®¤å¥½ä½ çš„æœåŠ¡å™¨æ“ä½œç³»ç»Ÿç±»å‹ï¼Œç„¶ååœ¨å®˜æ–¹æ–‡æ¡£ä¸­æ‰¾åˆ°ç›¸å…³çš„å®‰è£…å‘½ä»¤ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766989073962-9da0a62c-7dc3-4acf-80f2-f7a6f81e1b57.png)

è¿™å°æœåŠ¡å™¨çš„æ“ä½œç³»ç»Ÿæ˜¯ Ubuntuï¼Œå› æ­¤è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…ï¼š

```bash
curl -sSL https://resource.fit2cloud.com/1panel/package/quick_start.sh -o quick_start.sh && sudo bash quick_start.sh
```

åœ¨å®‰è£…çš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šæ¶‰åŠåˆ°è¯­è¨€ã€ç«¯å£ã€é¢æ¿è´¦å·å¯†ç çš„è®¾ç½®ç­‰ç­‰æ“ä½œï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766989488958-2a7a1b3f-817a-4482-a883-39df15f558cf.png)

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766989525878-04d95b82-f742-47bb-a422-e6c57bbb1514.png)

ç‰¹åˆ«æ˜¯ç«¯å£ã€è®¿é—®è·¯å¾„ã€è´¦å·å¯†ç ç­‰ç­‰ï¼Œè¿™äº›é…ç½®æ˜¯æ¯”è¾ƒé‡è¦çš„ã€‚

é…ç½®å®Œæ¯•ä»¥åï¼Œéœ€è¦åœ¨æœåŠ¡å™¨è¿è¥å•†ä¸­æ‰“å¼€åˆšåˆšè®¾ç½®çš„ç«¯å£ï¼Œè¿™æ ·æ‰èƒ½å¤Ÿé€šè¿‡é“¾æ¥æ¥è®¿é—®é¢æ¿ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766989791812-07aa9ae7-2072-4796-89e4-217f704c1420.png)

ç„¶åè¾“å…¥æœåŠ¡å™¨çš„å…¬ç½‘ IP + ç«¯å£ + è®¿é—®åç¼€ï¼ˆåœ¨å®‰è£…çš„æ—¶å€™å·²ç»è®¾ç½®å¥½äº†ï¼‰ï¼Œå³å¯è®¿é—®é¢æ¿ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766989858761-339c94b9-0714-4643-947f-f6f5ae6c72c4.png)

ç„¶åè¾“å…¥åˆšåˆšå®‰è£…çš„æ—¶å€™è®¾ç½®çš„è´¦å·å¯†ç ï¼Œå³å¯ç™»å½•åˆ°æœåŠ¡å™¨å†…éƒ¨ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766989969869-847ac845-1c47-4394-9940-71ea6c37b1f1.png)

åœ¨è¿™é‡Œå¯ä»¥å¾ˆæ–¹é¢é€šè¿‡å¯è§†åŒ–çš„æ–¹å¼æ¥æ“ä½œã€å®‰è£…ç›¸å…³çš„å†…å®¹ã€‚

## åˆ¤é¢˜æ²™ç®±éƒ¨ç½²
> ä»“åº“åœ°å€ï¼š[https://github.com/SmartOnlineJudge/smartoj-codesandbox](https://github.com/SmartOnlineJudge/smartoj-codesandbox)ã€‚
>

åˆ¤é¢˜æ²™ç®±æ˜¯ç”¨æ¥æ‰§è¡Œç”¨æˆ·æäº¤çš„ä»£ç ï¼Œå¹¶å°†æ‰§è¡Œç»“æœè¿”å›ç»™åç«¯ï¼Œåç«¯å†æ‰§è¡Œç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ã€‚

åˆ¤é¢˜æ²™ç®±å¿…é¡»éƒ¨ç½²åœ¨ Docker å®¹å™¨å†…éƒ¨ï¼Œè¿™æ ·æ˜¯ä¸ºäº†ç¡®ä¿å®¿ä¸»æœºçš„å®‰å…¨æ€§ï¼Œå› ä¸ºç”¨æˆ·å¾ˆå¯èƒ½ä¼šæäº¤ä¸€äº›æ¶æ„ä»£ç æ¥æ•…æ„ç ´åå®¿ä¸»æœºçš„å®Œæ•´æ€§ï¼Œè€Œ Docker å®¹å™¨å¯ä»¥å¾ˆå¥½åœ°å°†è¿›ç¨‹ä¸å®¿ä¸»æœºè¿›è¡Œéš”ç¦»ï¼Œå°±ç®—æ¶æ„ä»£ç çœŸçš„è¢«æ‰§è¡Œäº†ï¼Œé‚£ä¹ˆå½±å“çš„åªæ˜¯å®¹å™¨å†…éƒ¨çš„ç¯å¢ƒï¼Œä¸ä¼šå¯¹å®¿ä¸»æœºé€ æˆå½±å“ã€‚

é¦–å…ˆéœ€è¦å°†ä»£ç ä¸‹è½½åˆ°æœåŠ¡å™¨ä¸Šé¢ï¼Œå› ä¸ºæœ‰äº†å¯è§†åŒ–çš„æœåŠ¡å™¨è¿ç»´é¢æ¿ï¼Œå› æ­¤å¯ä»¥æ‰‹åŠ¨å°†ä»£ç ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766990848767-83b21f5b-f78a-4189-b41a-b7a7eb87a629.png)

æ–°å»ºä¸€ä¸ªç›®å½•ç”¨äºä¸“é—¨ä¿å­˜é¡¹ç›®æ‰€æœ‰çš„ä»£ç ï¼Œå¹¶é€‰æ‹©â€œä¸Šä¼ â€æŒ‰é’®ä¸Šä¼ ç›¸å…³ä»£ç ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766990928718-f2a01619-d20f-449d-ba00-8381865e1938.png)

ä¸Šä¼ å¥½é¡¹ç›®æ–‡ä»¶ä»¥åï¼Œéœ€è¦ä¸ºæ²™ç®±åˆ›å»ºä¸€ä¸ªå®¹å™¨ã€‚

åœ¨é¡¹ç›®ç›®å½•ä¸­å·²ç»ç¼–å†™å¥½äº†ä¸€ä¸ª Dockerfile æ–‡ä»¶ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766991209332-24705c7e-b6ad-458c-89d2-9a3c24237ae2.png)

æˆ‘ä»¬éœ€è¦ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶æ¥æ„å»ºä¸€ä¸ª Docker é•œåƒã€‚å¯ä»¥ä½¿ç”¨ Docker å‘½ä»¤æ„å»ºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¿ç»´é¢æ¿çš„å¯è§†åŒ–ç•Œé¢æ¥æ„å»ºï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766991436930-3c5a27d6-a19d-416c-be86-f1deeeda7c4f.png)

ç­‰å¾…ä¸€æ®µæ—¶é—´åï¼Œé•œåƒå°±æ„å»ºå¥½äº†ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766991582665-33b66477-7e5d-4738-a1cd-53cd0afbbde6.png)

æ„å»ºå®Œé•œåƒä»¥åï¼Œè¿˜éœ€è¦å°†é•œåƒå¯åŠ¨ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766991822713-bc28719c-4b62-48ef-9628-5ed30ea68cd3.png)

é€‰æ‹©åˆšåˆšåˆ›å»ºå¥½çš„é•œåƒï¼Œç„¶åé…ç½®é•œåƒçš„ç«¯å£ï¼Œè¿™é‡Œç«¯å£ä¸¤ä¸ªéƒ½è®¾ç½®ä¸º8080ã€‚

æŒ‰â€œç¡®è®¤â€å³å¯å¯åŠ¨é•œåƒï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766991896543-9b7d90c5-b27b-4e19-9335-a5539becc899.png)

æŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼Œæ˜¾ç¤ºä»¥ä¸‹å†…å®¹å°±è¡¨ç¤ºæ²™ç®±å·²ç»å¯åŠ¨äº†ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766992033209-de704aa9-ab13-414f-9b8a-c422583c9e2e.png)

è‡³æ­¤ï¼Œä»£ç æ²™ç®±çš„éƒ¨ç½²å°±åˆ°æ­¤ç»“æŸäº†ã€‚

## æ•°æ®åº“åŠä¸­é—´ä»¶å®‰è£…
> åœ¨éƒ¨ç½²åç«¯ä¹‹å‰ï¼Œéœ€è¦å…ˆå°†ç›¸å…³åç«¯ä¾èµ–çš„æ•°æ®åº“ã€ä¸­é—´ä»¶å®‰è£…å¥½ï¼Œè¿™æ ·æ‰èƒ½å¤Ÿå¯åŠ¨åç«¯ã€‚
>

### MySQL
MySQL æ˜¯é¡¹ç›®ä½¿ç”¨çš„ä¸»è¦æ•°æ®åº“ï¼Œç”¨äºä¿å­˜ç”¨æˆ·ã€é¢˜ç›®ã€é¢˜è§£ã€è®¨è®ºç­‰ç­‰æ ¸å¿ƒæ•°æ®ï¼Œæ˜¯æ•´ä¸ªé¡¹ç›®çš„æ ¸å¿ƒä¸šåŠ¡æ•°æ®åº“ã€‚

åœ¨å¼€å‘é˜¶æ®µä½¿ç”¨çš„ MySQL ç‰ˆæœ¬æ˜¯`8.0.43`ï¼Œå¹¶ä¸”ç‰ˆæœ¬**å¿…é¡»å¤§äºç­‰äº 8.0**ï¼Œå› ä¸ºé¡¹ç›®ä¸­çš„ä¾èµ–éœ€è¦ç”¨åˆ° MySQL 8.0 çš„ç‰¹æ€§ã€‚

ç”±äºæœåŠ¡å™¨è‡ªå¸¦äº† Dockerï¼Œå› æ­¤è¿™é‡Œä¹Ÿé€‰æ‹©ä½¿ç”¨ Docker æ¥ä¸€é”®å®‰è£… MySQLã€‚

åœ¨åº”ç”¨å•†åº—ä¸­é€‰æ‹© MySQL å¹¶ç‚¹å‡»å®‰è£…ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766992656065-f981835e-ff61-420a-a5e1-1e6d7e975287.png)

ç„¶åé€‰æ‹© 8.0.43 çš„ç‰ˆæœ¬ï¼Œè®¾ç½®å¥½å¯†ç ï¼Œå¹¶å…è®¸â€œç«¯å£å¤–éƒ¨è®¿é—®â€ï¼Œç„¶åç‚¹å‡»â€œç¡®è®¤â€å³å¯å®Œæˆå®‰è£…ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766992815059-4336e023-aaa2-4362-9544-457c8823c988.png)

ç‚¹å‡»â€œå®¹å™¨â€ä¸€æ å³å¯çœ‹åˆ° MySQL å·²ç»å¯åŠ¨ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766993004084-8f0cb473-240f-4e4c-aa0a-6b40e9493cf1.png)

åˆ°è¿™é‡Œè¿˜æ²¡å®Œï¼Œåœ¨é¡¹ç›®ä¸­ä½¿ç”¨äº† Binlog æ¥ç›‘å¬éƒ¨åˆ†è¡¨æ•°æ®çš„å˜åŒ–ï¼Œå¹¶æ ¹æ®æ•°æ®çš„å˜åŒ–æ¥æ‰§è¡Œç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ã€‚å› æ­¤è¿˜éœ€è¦å¼€å¯ MySQL çš„ Binlogã€‚

é¦–å…ˆæˆ‘ä»¬éœ€è¦æ‰¾åˆ° MySQL çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚æœä½ æ˜¯å®Œå…¨æŒ‰ç…§ä¸Šè¿°çš„æ“ä½œæ¥è¿›è¡Œçš„è¯ï¼Œé‚£ä¹ˆ MySQL çš„é…ç½®ä¸€èˆ¬ä¼šå­˜æ”¾åœ¨å®¿ä¸»æœºçš„`/opt/1panel/apps/mysql/mysql/conf`ç›®å½•ä¸‹ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766993467077-9dccb195-33e9-4f47-a3fc-7d60ee63ee3a.png)

> ä¸ºä»€ä¹ˆ MySQL è¢«å®‰è£…åœ¨å®¹å™¨å†…éƒ¨è€Œé…ç½®æ–‡ä»¶å´åœ¨å®¿ä¸»æœºä¸­å‘¢ï¼Ÿ
>
> ç­”ï¼šå› ä¸ºåœ¨ä½¿ç”¨ Docker æ¥å®‰è£… MySQL çš„æ—¶å€™ï¼Œ1Panel é¢æ¿ä¼šé»˜è®¤å°†æ•°æ®æŒ‚è½½åˆ°å®¿ä¸»æœºçš„æœ¬åœ°æ–‡ä»¶ç›®å½•ä¸­ï¼Œè€Œå®¹å™¨å†…éƒ¨ä¼šè‡ªåŠ¨é“¾æ¥å®¿ä¸»æœºä¸­çš„æ–‡ä»¶ã€‚è¿™å°±æ˜¯ Docker ä¸­â€œvolumeâ€çš„åŠŸèƒ½ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼šå½“å®¹å™¨è¢«å…³é—­äº†ï¼Œå®¹å™¨å†…éƒ¨ä¿å­˜çš„æ–‡ä»¶ä¹Ÿä¸ä¼šè¢«ä¸¢å¤±ã€‚
>

åŒå‡»æ‰“å¼€é…ç½®æ–‡ä»¶ï¼Œå¹¶åœ¨é…ç½®æ–‡ä»¶ä¸­è¿½åŠ ä»¥ä¸‹å†…å®¹ï¼š

```plain
# å¼€å¯ binlog
log_bin = mysql-bin
binlog_format = ROW
server_id = 1
binlog_row_metadata = FULL
# æ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶
binlog_expire_logs_seconds = 604800
```

ç„¶ååœ¨å®¹å™¨é¢æ¿ä¸­é‡å¯ MySQLï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766993686205-4ae0aa7c-c2fa-4d3a-8d82-6a6ce7c73d2d.png)

é‡å¯ä»¥åè¿›å…¥ MySQL çš„ç»ˆç«¯ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766993896998-da245489-6942-4067-87a7-5bff274bd223.png)

ç›´æ¥ç‚¹å‡»è¿æ¥ï¼Œç„¶ååœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œç„¶åæŒ‰å›è½¦æ¥ç€è¾“å…¥æ•°æ®åº“çš„å¯†ç ï¼š

```bash
mysql -u root -p
```

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766993982480-17d751ef-68a9-423f-8b87-4f4aa36dffae.png)

æ˜¾ç¤ºè¿™æ ·å°±ä»£è¡¨å·²ç»è¿›å…¥åˆ°äº† MySQL çš„å‘½ä»¤è¡Œäº¤äº’ç•Œé¢ä¸­äº†ï¼Œæˆ‘ä»¬éœ€è¦éªŒè¯åˆšåˆšçš„ Binlog æ˜¯å¦è¢«æ­£å¸¸å¼€å¯ã€‚

è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š

```bash
SHOW VARIABLES LIKE 'log_bin';
```

æ˜¾ç¤ºä»¥ä¸‹å†…å®¹å³è¡¨ç¤º Binlog å¼€å¯æˆåŠŸï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766994066602-a376ab85-cad8-4cc3-8c83-4460dbea0886.png)

è¿™ä¸€æ­¥ä¸€å®šè¦åšå®Œï¼Œä¸ç„¶åç«¯é¡¹ç›®æ˜¯è·‘ä¸èµ·æ¥çš„ã€‚

åˆ°æ­¤ä¸ºæ­¢ï¼ŒMySQL çš„å®‰è£…å·²ç»ç»“æŸäº†ã€‚

### Redis
Redis åœ¨é¡¹ç›®ä¸­ç”¨äºä¿å­˜ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ã€RabbitMQ çš„å­˜å‚¨åç«¯ä»¥åŠéƒ¨åˆ†åç«¯ç¼“å­˜æ•°æ®ã€‚

å¼€å‘é¡¹ç›®æ—¶ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯`8.0.3`ã€‚å®‰è£…æ¯”è¾ƒç®€å•ï¼Œåƒå®‰è£… MySQL é‚£æ ·åœ¨åº”ç”¨å•†åº—ä¸­é€‰æ‹©ç›¸åº”çš„ç‰ˆæœ¬å®‰è£…å³å¯ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766994501357-52a9c4fe-4677-430c-be18-3666bd388ac1.png)

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766994557214-f1886571-abac-4deb-b3e7-07080d6b7429.png)

åˆ°è¿™é‡Œ Redis çš„å®‰è£…å°±å·²ç»å®Œæˆäº†ï¼Œä¸éœ€è¦åšå…¶ä»–é¢å¤–çš„é…ç½®ã€‚

### ElasticSearch
è¯¥æ•°æ®åº“ä¸»è¦ç”¨äºå®ç°é¢˜ç›®çš„å…¨æ–‡æ£€ç´¢ï¼Œæ•°æ®æ¥æºä¸ MySQLï¼Œåç«¯é€šè¿‡ç›‘å¬ Binlog æ¥å®ç°å°†æ–°æ•°æ®åŒæ­¥åˆ° ES ä¸­ã€‚

åœ¨å¼€å‘é¡¹ç›®æ—¶ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯`8.18.4`ï¼ŒåŒæ ·å…ˆåˆ°åˆ°åº”ç”¨å•†åº—ä¸­å®‰è£…ESã€‚

> æ³¨æ„ï¼šElasticSearchçš„å†…å­˜å ç”¨è¾ƒé«˜ï¼Œè¯·ç¡®ä¿å½“å‰æœåŠ¡å™¨çš„ç©ºé—²å†…å­˜è‡³å°‘ 1GBã€‚
>

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766995187497-e938dabe-9a76-44a9-9b98-4218210cfe35.png)

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766995330887-43b19742-9e98-42d2-a999-ae772668631b.png)

å› ä¸º ElasticSearch æ˜¯ä½¿ç”¨ Java æ¥å®ç°çš„ï¼Œè€Œ JVM æœ¬èº«çš„å†…å­˜å ç”¨æ˜¯å¾ˆé«˜çš„ï¼Œå› æ­¤ ES çš„å†…å­˜å ç”¨ä¹ŸåŒæ ·ä¼šå˜å¾—å¾ˆé«˜ï¼Œå¦‚æœæœåŠ¡å™¨çš„å†…å­˜å®åœ¨ä¸è¶³äº†ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨äº‘ESï¼Œä¹Ÿå°±æ˜¯å„å¤§äº‘å‚å•†ï¼ˆé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰ç­‰ï¼‰æä¾›çš„ESæœåŠ¡ï¼Œè¿™æ ·å¯ä»¥é¿å…å› ä¸ºæœåŠ¡å™¨å†…å­˜ä¸è¶³è€Œå¯¼è‡´çš„æ— æ³•å®‰è£…ã€‚

åˆ°è¿™é‡Œè¿˜æ²¡æœ‰ç»“æŸï¼Œé¡¹ç›®ä¸­é¢˜ç›®çš„æè¿°ä¸€èˆ¬æ˜¯ä¸­æ–‡ï¼Œä½†æ˜¯ ES åœ¨è¿›è¡Œå…¨æ–‡æ£€ç´¢çš„æ—¶å€™ï¼Œé»˜è®¤ä½¿ç”¨è‹±æ–‡çš„æ–¹å¼æ¥å¯¹æ–‡æœ¬è¿›è¡Œåˆ†è¯ï¼Œè¿™æ ·ä¼šå¤§å¤§é™ä½æ£€ç´¢çš„å‡†ç¡®ç‡ï¼Œå› æ­¤è¿™é‡Œè¿˜éœ€è¦ä¸º ES æ·»åŠ ä¸€ä¸ªä¸­æ–‡åˆ†è¯å™¨æ’ä»¶ï¼šIK åˆ†è¯å™¨ã€‚

> æ’ä»¶å®˜æ–¹æ–‡æ¡£ï¼š[https://github.com/infinilabs/analysis-ik](https://github.com/infinilabs/analysis-ik)
>
> æ’ä»¶ä¸‹è½½é“¾æ¥ï¼š[https://release.infinilabs.com/analysis-ik/stable/](https://release.infinilabs.com/analysis-ik/stable/)
>

åœ¨æ’ä»¶åˆ—è¡¨é¡µé¢æ‰¾åˆ°å’Œåˆšåˆš ES çš„å®‰è£…ç‰ˆæœ¬ä¸€æ¨¡ä¸€æ ·çš„æ’ä»¶ç‰ˆæœ¬ï¼Œå¿…é¡»ä¸€æ¨¡ä¸€æ ·ï¼Œåˆšåˆšå®‰è£…çš„ ES ç‰ˆæœ¬æ˜¯`8.18.4`ï¼Œé‚£ä¹ˆæ’ä»¶çš„ç‰ˆæœ¬ä¹Ÿå¿…é¡»ä¸€æ¨¡ä¸€æ ·ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766995693503-86dff01b-9cfc-43d9-a703-fcd5454d7bbb.png)

ä¸‹è½½ä»¥åä¼šå¾—åˆ°ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™ä¸ªå‹ç¼©åŒ…è§£å‹åˆ° ES çš„æ’ä»¶ç›®å½•ä¸­ã€‚

> IK æ’ä»¶å®‰è£…å‚è€ƒæ•™ç¨‹ï¼š[https://developer.aliyun.com/article/1589546](https://developer.aliyun.com/article/1589546)
>

å¦‚æœä½ æ˜¯ç›´æ¥ä½¿ç”¨ 1Panel æ¥å®‰è£… ES çš„ï¼Œé‚£ä¹ˆæ’ä»¶çš„ç›®å½•ä¸€èˆ¬æ˜¯å®¿ä¸»æœºä¸Šçš„ï¼š`/opt/1panel/apps/elasticsearch/elasticsearch/data/plugins`ç›®å½•ã€‚å¦‚æœæ²¡æœ‰`plugins`ç›®å½•é‚£éœ€è¦æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªã€‚

ç„¶åè¿›å…¥åˆ°`plugins`ç›®å½•ä¸­ï¼Œå†åˆ›å»ºä¸€ä¸ª`ik`ç›®å½•ï¼Œå°†åˆšåˆšä¸‹è½½å¥½çš„ IK åˆ†è¯å™¨å‹ç¼©åŒ…è§£å‹åˆ°è¯¥ç›®å½•ä¸‹ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766996716411-4b1965f5-53b9-4f35-8f39-f1069a3d1abc.png)

æœ€ç»ˆçš„ç›®å½•ç»“æ„åº”è¯¥æ˜¯å¦‚ä¸Šå›¾çš„æ ·å­ã€‚

> æ³¨æ„ï¼š`/opt/1panel/apps/elasticsearch/elasticsearch/data/plugins`ç›®å½•ä¸‹ä¸èƒ½åŒ…å«æ— æ•ˆçš„æ’ä»¶ç›®å½•ï¼Œå¦åˆ™ ES å°†ä¼šå¯åŠ¨å¤±è´¥ã€‚åœ¨æœ¬æ¬¡å®‰è£…è¿‡ç¨‹ä¸­ï¼Œplugins ç›®å½•ä¸‹åº”è¯¥åªåŒ…å« ik ç›®å½•ã€‚
>

å…ˆæ£€æŸ¥`plugins`ç›®å½•æœ‰æ²¡æœ‰è¢«æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766998374645-24f2faad-0b6b-421f-9d04-e3a2b81a804a.png)

å¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆéœ€è¦å…ˆå°†`plugins`çš„ç›®å½•æŒ‚è½½åˆ° ES å®¹å™¨å†…éƒ¨çš„`plugins`ç›®å½•ä¸­ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚

æ¥ç€é‡å¯ ESï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766996858409-2e695f82-5987-4fef-8f26-1e52f46c88e0.png)

ç„¶åè¿›å…¥åˆ° ES å®¹å™¨çš„ç»ˆç«¯ï¼Œè¿›å…¥åˆ° bin ç›®å½•ä¸‹ï¼Œè¾“å…¥ï¼š

```bash
elasticsearch-plugin list
```

æ˜¾ç¤ºä»¥ä¸‹å†…å®¹å³ä»£è¡¨ IK åˆ†è¯å™¨å®‰è£…æˆåŠŸï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766998519204-3b524399-5575-4bc7-a44b-332758caad12.png)

è‡³æ­¤ï¼ŒES çš„å®‰è£…å°±ç»“æŸäº†ã€‚

### RabbitMQ
è¯¥ä¸­é—´ä»¶ä¸»è¦ç”¨äºåç«¯çš„æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡ï¼Œä¾‹å¦‚é‚®ä»¶å‘é€ã€æ•°æ®åŒæ­¥ã€è°ƒç”¨åˆ¤é¢˜æ²™ç®±ç­‰ç­‰ä»»åŠ¡ã€‚

é¡¹ç›®å¼€å‘æ—¶ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯`4.0.7`ï¼Œç›´æ¥åœ¨åº”ç”¨å•†åº—å®‰è£…å³å¯ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766998934135-3d29e037-ad19-4460-952b-bd93813e8f43.png)

### MinIO
ç”¨äºä¿å­˜ç”¨æˆ·å¤´åƒã€é¢˜è§£å›¾ç‰‡ç­‰äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œ

é¡¹ç›®å¼€å‘æ—¶ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯`2025-02-18`ï¼Œç›´æ¥åœ¨åº”ç”¨å•†åº—å®‰è£…å³å¯ã€‚

åˆ°è¿™ä¸€æ­¥ç»“æŸï¼Œè¿ç»´é¢æ¿å±•ç¤ºçš„å®¹å™¨åº”è¯¥åŒ…æ‹¬ä»¥ä¸‹ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766999382354-664be147-23d0-43a2-9e5c-7572c51714a9.png)

å¦‚æœå’Œä¸Šå›¾ä¸€æ ·ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥äº†ã€‚

## åç«¯éƒ¨ç½²
> ä»“åº“åœ°å€ï¼š[https://github.com/SmartOnlineJudge/smartoj-backend](https://github.com/SmartOnlineJudge/smartoj-backend)ã€‚
>

### åç«¯ä¾èµ–å®‰è£…
åç«¯ä½¿ç”¨çš„ Python ç‰ˆæœ¬å¿…é¡»å¤§äºç­‰äº 3.11ï¼Œå¦åˆ™å°†ä¸èƒ½æ­£å¸¸å¯åŠ¨ã€‚

é¡¹ç›®ä½¿ç”¨ uv æ¥ç®¡ç† Python çš„ç¬¬ä¸‰æ–¹åº“ï¼Œå› æ­¤éœ€è¦å…ˆå°† uv å®‰è£…å¥½ã€‚

```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

å…ˆä½¿ç”¨ uv å®‰è£…å¥½ Python3.11ï¼š

```bash
uv python install 3.11
```

åŒæ—¶å®‰è£…å¥½åç«¯é¡¹ç›®ä¾èµ–ï¼š

```bash
uv sync
```

åˆ°è¿™ä¸€æ­¥å…ˆä¸è¦å¯åŠ¨åç«¯ï¼Œå› ä¸ºè¿˜æœ‰ä¸€äº›é…ç½®å’Œæ•°æ®éœ€è¦ç¼–å†™å’Œå¯¼å…¥ã€‚

### é…ç½®æ–‡ä»¶ç¼–å†™
åœ¨é¡¹ç›®ç›®å½•ä¸‹æœ‰ä¸€ä¸ª`metadata.json`æ–‡ä»¶ï¼š

```json
{
  "metadata": {
    "databases": {
      "mysql": {
        "default": {
          "USER": "your_user",  // è´¦å·
          "PASSWORD": "your_password",  // å¯†ç 
          "PORT": 3306,
          "HOST": "127.0.0.1",  // smartojæ•°æ®åº“çš„åœ°å€
          "NAME": "your_db_name"  // è¿™é‡Œé»˜è®¤å¡«å†™smartoj
        }
      },
      "redis": {
        "default": {
          "HOST": "127.0.0.1",
          "PORT": 6379,
          "DB": 0,
          "PASSWORD": null  // å¦‚æœæœ‰å¯†ç ï¼Œåˆ™éœ€è¦å¡«å†™
        },
        "session": {
          "HOST": "127.0.0.1",
          "PORT": 6379,
          "DB": 1,
          "PASSWORD": null  // å¦‚æœæœ‰å¯†ç ï¼Œåˆ™éœ€è¦å¡«å†™
        },
        "mq": {
          "HOST": "127.0.0.1",
          "PORT": 6379,
          "DB": 2,
          "PASSWORD": null  // å¦‚æœæœ‰å¯†ç ï¼Œåˆ™éœ€è¦å¡«å†™
        }
      },
      "elasticsearch": {
        "default": {
          "URL": "http://127.0.0.1:9200",
          "USER": "elastic",  // ES ç”¨æˆ·å
          "PASSWORD": "elastic"  // ES å¯†ç 
        }
      }
    },
    "secrets": {
      "PASSWORD": "your_secret",
      "GITHUB_OAUTH2": {
        "client_id": "your client id",
        "client_secret": "your client secret"
      }
    },
    "minio": {
      "access_key": "your_access_key",  // minio çš„è´¦å·
      "secret_key": "your_secret_key",  // minio çš„å¯†ç 
      "endpoint": "127.0.0.1:9000",
      "secure": false
    },
    "rabbitmq": {
      "url": "amqp://guest:guest@127.0.0.1"  // è´¦å·å¯†ç 
    },
    "smtp": {
      "host": "smtp.example.com",
      "port": 587,
      "name": "æ™ºèƒ½ç®—æ³•åˆ·é¢˜å¹³å°-é‚®ä»¶ç³»ç»Ÿ",
      "password": "your_password",
      "from": "no-reply@example.com"
    }
  }
}
```

åœ¨ä¸Šè¿°é…ç½®æ–‡ä»¶ä¸­ï¼ŒMySQLã€Redisã€ElasticSearchã€RabbitMQã€MinIOç­‰æ•°æ®åº“çš„é…ç½®åº”è¯¥åœ¨å®‰è£…çš„æ—¶å€™å°±å·²ç»è®°å¥½äº†ï¼Œç›´æ¥å¡«åˆ°é…ç½®æ–‡ä»¶é‡Œé¢å³å¯ã€‚

è¿™é‡Œéœ€è¦æ³¨æ„çš„å…¶ä»–ä¸¤ä¸ªé…ç½®é¡¹ï¼š

```json
"secrets": {
  "PASSWORD": "your_secret",
  "GITHUB_OAUTH2": {
    "client_id": "your client id",
    "client_secret": "your client secret"
  }
},
```

è¿™ä¸ªé…ç½®é¡¹æ˜¯ä¸“é—¨é…ç½®å¯†é’¥çš„ã€‚

`PASSWORD`æ˜¯åœ¨åŠ å¯†ç”¨æˆ·å¯†ç æ—¶ç”¨çš„å¯†é’¥ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›å¯†é’¥ç”Ÿæˆå·¥å…·æ¥ç”Ÿæˆä¸€ä¸ªå¯†é’¥ï¼Œç„¶åä½¿ç”¨ base64 å°†è¿™ä¸ªå¯†é’¥ç¼–ç ã€‚

è€Œ`GITHUB_OAUTH2`åˆ™æ˜¯åœ¨ä½¿ç”¨ GitHub è¿›è¡Œ OAuth2 è®¤è¯æ—¶çš„é…ç½®ï¼Œè¿™éœ€è¦åˆ° GitHub ä¸Šç”³è¯·ä¸€ä¸ª OAuth APPï¼Œç”³è¯·å¥½ä»¥åå°±ä¼šå¾—åˆ°ç›¸å…³çš„`client_id`å’Œ`client_secret`ã€‚å°†å®ƒä»¬å¡«å…¥åˆ°é…ç½®æ–‡ä»¶ä¸­å³å¯ã€‚

è¿˜æœ‰ä¸€ä¸ªé…ç½®é¡¹æ˜¯é‚®ä»¶é…ç½®ï¼š

```json
"smtp": {
  "host": "smtp.example.com",
  "port": 587,
  "name": "æ™ºèƒ½ç®—æ³•åˆ·é¢˜å¹³å°-é‚®ä»¶ç³»ç»Ÿ",
  "password": "your_password",
  "from": "no-reply@example.com"
}
```

è¿™é‡Œæ˜¯åŸºäº SMTP æ¥å‘é€é‚®ä»¶çš„ï¼Œå¯ä»¥åœ¨ QQ æˆ–è€… 163 ä¸Šé¢ç”³è¯·ä¸€ä¸ª SMTP åº”ç”¨ï¼Œç”³è¯·å¥½ä»¥åå°†`host`ã€`port`ã€`password`ã€`from`è¿™ 4 ä¸ªé…ç½®å¡«å¥½å°±è¡Œäº†ã€‚

å¦å¤–ä¸€ä¸ªé…ç½®æ–‡ä»¶æ˜¯`settings.py`ã€‚è¿™ä¸ªé…ç½®æ–‡ä»¶éœ€è¦æ³¨æ„ä»¥ä¸‹é…ç½®é¡¹ï¼š

```python
# æ˜¯å¦æ˜¯å¼€å‘ç¯å¢ƒ
DEV_ENV: bool = True  # éƒ¨ç½²æ—¶è¯·å°†å®ƒè®¾ç½®ä¸º False

# è¯·æ±‚ä»£ç†åœ°å€
# åç«¯å‘ GitHub å‘é€è¯·æ±‚çš„æ—¶å€™ä¼šç”¨åˆ°
PROXY_URL = "socks5://127.0.0.1:1080"

# ä»£ç æ²™ç®±åˆ¤é¢˜æ¥å£åœ°å€
CODESANDBOX_URL = "http://127.0.0.1:8080/sandbox/judgement"
```

ä¸€ä¸ªä»£ç æ²™ç®±åœ°å€ï¼Œå¦‚æœä½ çš„åç«¯å’Œä»£ç æ²™ç®±æ˜¯éƒ¨ç½²åœ¨åŒä¸€å°æœºå™¨ä¸Šé¢çš„è¯ï¼Œå¯ä»¥é»˜è®¤ä¸ç”¨ä¿®æ”¹ã€‚

è¿˜æœ‰ä¸€ä¸ªæ˜¯`PROXY_URL`ï¼Œåœ¨ä½¿ç”¨ GitHub æ¥è¿›è¡Œ OAuth2 è®¤è¯çš„æ—¶å€™ï¼Œåç«¯éœ€è¦å‘ GitHub å‘é€è¯·æ±‚ï¼Œè€Œé€šå¸¸è¿™ä¸ªè¿‡ç¨‹å¾ˆå¤§æ¦‚ç‡ä¼šå¤±è´¥ï¼Œå› æ­¤å‘é€è¯·æ±‚çš„æ—¶å€™éœ€è¦å…ˆç»è¿‡ä¸€ä¸ªä»£ç†ï¼Œè¿™æ ·æ‰ä¼šä¿è¯å‘é€è¯·æ±‚çš„æˆåŠŸç‡ã€‚

ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹çš„è„šæœ¬æ¥éªŒè¯ä½ çš„ä»£ç†æ˜¯å¦æ˜¯æœ‰ç”¨çš„ï¼Œåœ¨é¡¹ç›®ç›®å½•ä¸‹ç¼–å†™ä»¥ä¸‹ä»£ç ï¼š

```python
import httpx
from httpx_socks import SyncProxyTransport
from utils.generic import parse_proxy_url

proxy_url = "socks5://127.0.0.1:1080"  # ä½ çš„ä»£ç†
proxy_config = parse_proxy_url(proxy_url)
transport = SyncProxyTransport(**proxy_config)
client = httpx.Client(transport=transport)
response = client.get("https://google.com")
print(response.text)
```

å¦‚æœè¾“å‡ºä»¥ä¸‹å†…å®¹ï¼š

```plain
<HTML><HEAD><meta http-equiv="content-type" content="text/html;charset=utf-8">
<TITLE>301 Moved</TITLE></HEAD><BODY>
<H1>301 Moved</H1>
The document has moved
<A HREF="https://www.google.com/">here</A>.
</BODY></HTML>
```

åˆ™ä»£è¡¨ä½ çš„ä»£ç†æˆåŠŸè¯·æ±‚äº† Google çš„æœåŠ¡å™¨å¹¶æ¥æ”¶äº†å“åº”ã€‚å¦‚æœä¸èƒ½è¯·æ±‚ï¼Œé‚£ä¹ˆåˆ™è¡¨ç¤ºä½ çš„ä»£ç†å¯èƒ½ä¹Ÿæ— æ³•æ­£å¸¸è¯·æ±‚ GitHubã€‚

> ä¸€èˆ¬ä»£ç†æœåŠ¡å™¨éƒ½ä¸æ˜¯ç›´æ¥æä¾› socks5 è¿™æ ·çš„åè®®ï¼Œéœ€è¦å…ˆç»è¿‡ Clashã€SingBox ç­‰è¿™æ ·çš„ä»£ç†å·¥å…·æ‰èƒ½å°†åè®®è½¬æ¢æˆ socks5 åè®®ã€‚
>

### åŸºæœ¬æ•°æ®å‡†å¤‡
#### ç”¨æˆ·é»˜è®¤å¤´åƒä¸Šä¼ 
é¦–å…ˆéœ€è¦ä¸Šä¼ ä¸€ä¸ªé»˜è®¤çš„ç”¨æˆ·å¤´åƒåˆ° MinIO æœåŠ¡å™¨ä¸Šã€‚

é¦–å…ˆç¡®ä¿æœåŠ¡å™¨çš„ 9001 ç«¯å£åœ¨é˜²ç«å¢™ä¸­å¼€æ”¾ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766999757146-fa2f4e8e-2a99-4f2a-946a-88c6033a2aff.png)

ç„¶åè¿›å…¥åˆ° MinIO çš„å¯è§†åŒ–åå°ä¸­ï¼šhttp://106.52.180.63:9001ã€‚

è¾“å…¥å®‰è£… MinIO æ—¶è®¾ç½®çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œç™»å½•å³å¯è¿›å…¥åˆ° MinIO çš„å¯è§†åŒ–ç®¡ç†ç•Œé¢ä¸­ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1766999895554-490813d0-fd4d-41c2-b014-b36285ee7080.png)

æˆ‘ä»¬éœ€è¦ä¸ºåˆ›å»ºä¸€ä¸ªæ¡¶æ¥ä¸“é—¨å­˜å‚¨ç”¨æˆ·çš„å¤´åƒï¼Œè¿™ä¸ªæ¡¶çš„åç§°åç«¯é»˜è®¤è®¾ç½®çš„æ˜¯`user-avatars`ã€‚å¯ä»¥åœ¨`storage/oss.py`æ–‡ä»¶ä¸­ä¿®æ”¹ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1767000104702-a84e12e7-d3ff-45ee-924a-f7c2f92da26a.png)

åœ¨ MinIO çš„å¯è§†åŒ–ç•Œé¢ä¸­åˆ›å»ºè¿™ä¸ªæ¡¶ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1767000149801-b7d86ea9-0e8b-4161-9cfe-57944ab210cf.png)

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1767000165972-1e303b31-2375-4f86-9330-233a8780fc39.png)

åˆ›å»ºå¥½ä»¥åéœ€è¦å°†è¿™ä¸ªæ¡¶çš„è®¿é—®æƒé™æ”¹æˆå…¬å¼€ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1767000235562-358b5a5a-f3b7-4f8b-9c60-af9d9c814c8f.png)

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1767000250028-e2301d58-87c4-4675-8b6b-40de172e9d08.png)

ç„¶åä¸Šä¼ ä¸€å¼ é»˜è®¤å¤´åƒåˆ°è¿™ä¸ªæ¡¶ä¸­ï¼Œåç«¯é»˜è®¤çš„å¤´åƒåç§°æ˜¯ï¼Œ`settings.py`æ–‡ä»¶ä¸­ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1767000296647-23b390e9-3b8c-4b9a-9dba-6f6c5e8ad0fb.png)

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1767000329910-db06b164-e312-4505-a9d0-ea728bdcada9.png)

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1767000522754-68b86ef4-a92b-4d64-9cf8-5ff8d9585cd2.png)

æ¡¶ä¸­æ˜¾ç¤ºä»¥ä¸‹æ–‡ä»¶å³å¯ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1767000549169-22ff3df2-2fe9-42cd-afb8-3f92d7e2dff1.png)

#### MySQL æ•°æ®åº“åˆ›å»ºä¸æ•°æ®ä¸Šä¼ 
è¿™é‡Œçš„æ•°æ®åº“æŒ‡çš„æ˜¯ MySQLï¼Œåœ¨é¡¹ç›®ä¸­ä¸€å…±ä½¿ç”¨åˆ°ä¸¤ä¸ªæ•°æ®åº“ï¼š

1. smartojï¼šåç«¯åŸºæœ¬ä¸šåŠ¡æ•°æ®åº“ï¼Œä¿å­˜åç«¯åŸºæœ¬ä¸šåŠ¡çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ç”¨æˆ·ã€é¢˜ç›®ç­‰ç­‰ã€‚
2. smartojaiï¼šAI æœåŠ¡æ•°æ®åº“ï¼Œä¿å­˜å’Œ AI çš„å¯¹è¯æ•°æ®ã€‚

å› æ­¤éœ€è¦å…ˆåœ¨ MySQL ä¸­åˆ›å»ºè¿™ä¸¤ä¸ªæ•°æ®åº“ã€‚åœ¨åˆ›å»ºæ•°æ®åº“çš„æ—¶å€™ï¼Œè¯·ç¡®ä¿æ•°æ®åº“çš„ç¼–ç æ ¼å¼ä¸º`utf8mb4`ï¼Œæ’åºæ–¹å¼ä¸º`utf8mb4_0900_ai_ci`ï¼š

```sql
CREATE DATABASE smartoj
  DEFAULT COLLATE SET = 'utf8mb4_0900_ai_ci'
  DEFAULT CHARACTER SET = 'utf8mb4';

CREATE DATABASE smartojai
  DEFAULT COLLATE SET = 'utf8mb4_0900_ai_ci'
  DEFAULT CHARACTER SET = 'utf8mb4';
```

åˆ›å»ºå¥½æ•°æ®åº“ä»¥åï¼Œåœ¨åç«¯ä»£ç ä»“åº“ä¸­çš„é¡¹ç›®ç›®å½•ä¸‹ä¼šæœ‰ä¸€ä¸ª`smartoj.sql`çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™ä¸ªæ•°æ®å¤‡ä»½åˆ°æœåŠ¡å™¨ä¸Šçš„ MySQL ä¸­ã€‚è¿™ä¸ªå¤‡ä»½å¯ä»¥ç›´æ¥ä½¿ç”¨å‘½ä»¤æ¥å¯¼å…¥ï¼š

```sql
mysql -h 106.52.180.63 -P 3306 -u root -p 'password' smartoj < '/path/to/smartoj.sql'
```

ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€äº›å¯è§†åŒ–çš„æ•°æ®åº“ç®¡ç†å·¥å…·æ¥æ“ä½œï¼Œä¾‹å¦‚ Navicatã€DataGrid ç­‰ç­‰ã€‚åªè¦å°†æ•°æ®å¯¼å…¥åˆ°æ•°æ®åº“ä¸­å³å¯ã€‚

æ­¤å¤–ï¼Œè¿˜éœ€è¦ä¸º`smartojai`è¿™ä¸ªæ•°æ®åº“åˆ›å»ºä¸¤å¼ è¡¨ï¼š

```sql
CREATE TABLE conversations (
    id INT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(50) NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    is_deleted BOOLEAN NOT NULL DEFAULT FALSE,
    user_id VARCHAR(13) NOT NULL,
    question_id INT DEFAULT NULL,
    thread_id VARCHAR(128) NOT NULL UNIQUE,
    INDEX idx_user_id_is_deleted_question_id (user_id, is_deleted, question_id),
    INDEX idx_updated_at (updated_at)
)

CREATE TABLE memories (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id VARCHAR(13) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    content VARCHAR(50) NOT NULL,
    type ENUM("level", "ability", "preference"),
    INDEX idx_user_id (user_id)
)
```

#### ElasticSearch æ•°æ®è¿ç§»
ES ä¸­çš„æ•°æ®éœ€è¦ä» MySQL ä¸­è¿ç§»éƒ¨åˆ†æ•°æ®è¿‡æ¥ï¼Œå…¶ä¸­æ¶‰åŠåˆ°çš„è¡¨ç»“æ„åŒ…æ‹¬ï¼šquestionã€tagã€question_tagã€‚ä¸ºäº†å®ç°å…¨æ–‡æ£€ç´¢ï¼Œéœ€è¦å°†è¿™äº›æ•°æ®ä» MySQL ä¸­è¿ç§»è¿‡æ¥ã€‚

åœ¨é¡¹ç›®ç›®å½•ä¸‹çš„`scripts`ä¸­ï¼Œæœ‰ä¸€ä¸ªè„šæœ¬ï¼š`create_es_data.py`ã€‚

æˆ‘ä»¬éœ€è¦ä»¥æ¨¡å—çš„æ–¹å¼æ¥è¿è¡Œè¿™ä¸ªè„šæœ¬ï¼š

```bash
uv run python3 -m scripts.create_es_data
```

è¿™ä¼šè¯»å–é¡¹ç›®çš„é…ç½®æ–‡ä»¶ï¼Œè¿æ¥ MySQL å’Œ ESï¼Œå¹¶å°† MySQL ä¸­çš„éƒ¨åˆ†æ•°æ®è¿ç§»åˆ° ES ä¸­ã€‚

å¦‚æœæ˜¾ç¤ºä»¥ä¸‹æ—¥å¿—ï¼Œé‚£ä¹ˆåˆ™ä»£è¡¨æ•°æ®è¿ç§»æˆåŠŸï¼š

```plain
åˆ›å»º question ç´¢å¼•æˆåŠŸï¼
{'_index': 'question', '_id': '1', '_version': 1, 'result': 'created', '_shards': {'total': 2, 'successful': 1, 'failed': 0}, '_seq_no': 0, '_primary_term': 1}
{'_index': 'question', '_id': '373', '_version': 1, 'result': 'created', '_shards': {'total': 2, 'successful': 1, 'failed': 0}, '_seq_no': 1, '_primary_term': 1}
{'_index': 'question', '_id': '374', '_version': 1, 'result': 'created', '_shards': {'total': 2, 'successful': 1, 'failed': 0}, '_seq_no': 2, '_primary_term': 1}
{'_index': 'question', '_id': '375', '_version': 1, 'result': 'created', '_shards': {'total': 2, 'successful': 1, 'failed': 0}, '_seq_no': 3, '_primary_term': 1}
{'_index': 'question', '_id': '376', '_version': 1, 'result': 'created', '_shards': {'total': 2, 'successful': 1, 'failed': 0}, '_seq_no': 4, '_primary_term': 1}
more...
```

#### Redis ä¿å­˜ MySQL å½“å‰çš„ Binlog
åˆšåˆšé€šè¿‡æ‰‹åŠ¨æ‰§è¡Œè¿ç§»è„šæœ¬çš„æ–¹å¼å°† MySQL çš„æ•°æ®è¿ç§»åˆ°äº† ES ä¸­ï¼Œä½†æ˜¯ä»¥å  MySQL æ¯å˜æ›´ä¸€æ¬¡æ•°æ®ï¼Œéƒ½éœ€è¦æ‰§è¡Œä¸€æ¬¡è¿ç§»è„šæœ¬å—ï¼Ÿ

è¿™æ ·åšä¹Ÿä¸æ˜¯ä¸è¡Œï¼Œåªæ˜¯è¿™æ ·åšçš„æ•ˆç‡å¤ªä½äº†ã€‚æˆ‘ä»¬å®Œå…¨å¯ä»¥é€šè¿‡ MySQL çš„ Binlog æ¥å¢é‡å¼çš„åŒæ­¥æ•°æ®ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å°† MySQL ç°åœ¨çš„ Binlog ä½ç½®ä¿å­˜èµ·æ¥ï¼Œä»å½“å‰ Binlog ä½ç½®å¼€å§‹ï¼Œå¦‚æœç›‘å¬åˆ° MySQL æœ‰æ•°æ®å˜æ›´æˆ–è€…æ•°æ®å¢åŠ ï¼Œå°±å¯ä»¥åªä»å½“å‰ä½ç½®åŒæ­¥æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å°†æ•°æ®å…¨éƒ¨åŒæ­¥ã€‚

å› æ­¤åœ¨è¿™ä¸€æ­¥æˆ‘ä»¬éœ€è¦å°† Binlog çš„ä½ç½®ä¿å­˜åœ¨ Redis ä¸­ã€‚

å…ˆåœ¨ MySQL çš„å‘½ä»¤è¡Œä¸­æŸ¥çœ‹å½“å‰ Binlog çš„ä½ç½®ï¼š

```sql
SHOW MASTER STATUS;
```

è¿™å°†ä¼šè¾“å‡ºä»¥ä¸‹å†…å®¹ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1767010160908-1cc9c059-a88e-47c3-8e78-81c5b14af2ba.png)

æˆ‘ä»¬éœ€è¦å°† Fileã€Position ä¿å­˜èµ·æ¥ã€‚åœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼Œæœ‰ä¸€ä¸ª`scripts/listen_mysql_binlog.py`æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªå‡½æ•°ï¼š`save_binlog_position`ã€‚

æˆ‘ä»¬éœ€è¦è°ƒç”¨ä¸€éè¿™ä¸ªå‡½æ•°ï¼Œå°†å½“å‰ Binlog ä¿å­˜åœ¨ Redis ä¸­ï¼š

```python
import asyncio
from scripts.listen_mysql_binlog import save_binlog_position, load_binlog_position

async def main():
    await save_binlog_position("mysql-bin.000001", 186310)
    print(await load_binlog_position())

asyncio.run(main())
```

å¦‚æœè¾“å‡ºäº†åˆšåˆšä¿å­˜çš„ Binlogï¼Œé‚£ä¹ˆè¿™ä¸€æ­¥çš„ä»»åŠ¡å°±å®Œæˆäº†ï¼

### éƒ¨ç½²åç«¯ç¨‹åº
å‰é¢çš„æ•°æ®åº“å®‰è£…ã€ä¸­é—´ä»¶å®‰è£…ã€æ•°æ®è¿ç§»ç­‰ç­‰æ­¥éª¤éƒ½æ˜¯ä¸ºäº†åç«¯éƒ¨ç½²åšçš„é“ºå«ã€‚ç°åœ¨ï¼Œç»ˆäºå¯ä»¥çœŸæ­£çš„å¯åŠ¨åç«¯ç¨‹åºäº†ï¼š

```bash
uv run main.py
```

å½“è¾“å‡ºä»¥ä¸‹å†…å®¹çš„æ—¶å€™ï¼Œå°±ä»£è¡¨åç«¯æˆåŠŸå¯åŠ¨äº†ï¼š

```bash
INFO:     2025-12-29 20:20:39,822 - Started server process [99435]
INFO:     2025-12-29 20:20:39,822 - Waiting for application startup.
INFO:     2025-12-29 20:20:39,822 - Creating RabbitMQ connection
INFO:     2025-12-29 20:20:39,839 - Application startup complete.
INFO:     2025-12-29 20:20:39,849 - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
```

å¦‚æœä½ çš„æœåŠ¡å™¨å·²ç»æ‰“å¼€äº† 8000 è¿™ä¸ªç«¯å£ï¼Œé‚£ä¹ˆä½ å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¯•å›¾è®¿é—®åç«¯çš„ API æ¥å£æ–‡æ¡£ã€‚

åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ï¼šæœåŠ¡å™¨åœ°å€ + :8000/docsã€‚

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1767010998313-d1ff2f97-7882-417f-80a6-de6e1aa7e1c7.png)

é™¤äº†å¯åŠ¨åç«¯ä¸»ç¨‹åºä»¥å¤–ï¼Œè¿˜æœ‰ 2 ä¸ªç¨‹åºéœ€è¦å¯åŠ¨ï¼š

1. æ¶ˆæ¯é˜Ÿåˆ—

```bash
uv run taskiq worker mq.broker:broker --workers 2
```

2. Binlog ç›‘å¬ç¨‹åº

```bash
uv run -m scripts.listen_mysql_binlog
```

ä½†æ˜¯æˆ‘ä»¬ä¸åº”è¯¥æ‰‹åŠ¨è¿è¡Œè¿™äº›å¯åŠ¨å‘½ä»¤ï¼Œè€Œæ˜¯è®©è¿›ç¨‹ç®¡ç†å™¨æ¥å¸®æˆ‘ä»¬è¿è¡Œã€‚

è¿™é‡Œä½¿ç”¨ Supervisor æ¥ç®¡ç†è¿™äº›è¿›ç¨‹ã€‚å…ˆå®‰è£… Supervisorï¼š

```bash
sudo apt-get install supervisor
sudo systemctl enable supervisor.service  # å¼€æœºè‡ªåŠ¨å¯åŠ¨
```

åœ¨`/etc/supervisor/conf.d/`ç›®å½•ä¸‹ç¼–å†™ 3 ä¸ªé…ç½®æ–‡ä»¶ï¼š

1. backend.conf

```bash
[program:backend]
command=/path/to/smartoj-backend/.venv/bin/uvicorn main:app --host 127.0.0.1 --log-config /path/to/smartoj-backend/log-config.json
directory=/path/to/smartoj-backend
user=root
autostart=true
autorestart=true
stderr_logfile=/var/log/smartoj/backend.err.log  # å…ˆç¡®ä¿ç›®å½•å­˜åœ¨
stdout_logfile=/var/log/smartoj/backend.out.log  # å…ˆç¡®ä¿ç›®å½•å­˜åœ¨
logfile_maxbytes=5MB
```

2. taskiq.conf

```bash
[program:taskiq]
command=/path/to/smartoj-backend/.venv/bin/taskiq worker mq.broker:broker
directory=/path/to/smartoj-backend
user=root
autostart=true
autorestart=true
stderr_logfile=/var/log/smartoj/taskiq.err.log  # å…ˆç¡®ä¿ç›®å½•å­˜åœ¨
stdout_logfile=/var/log/smartoj/taskiq.out.log  # å…ˆç¡®ä¿ç›®å½•å­˜åœ¨
logfile_maxbytes=5MB
```

3. binlog.conf

```bash
[program:binlog]
command=/path/to/smartoj-backend/.venv/bin/python3 -m scripts.listen_mysql_binlog
directory=/path/to/smartoj-backend
user=root
autostart=true
autorestart=true
stderr_logfile=/var/log/smartoj/binlog.err.log  # å…ˆç¡®ä¿ç›®å½•å­˜åœ¨
stdout_logfile=/var/log/smartoj/binlog.out.log  # å…ˆç¡®ä¿ç›®å½•å­˜åœ¨
logfile_maxbytes=5MB
```

ä¸Šè¿° 3 ä¸ªæ–‡ä»¶åˆ†åˆ«æ˜¯åç«¯ã€æ¶ˆæ¯é˜Ÿåˆ—ã€MySQL Binlog ç›‘å¬è¿›ç¨‹çš„ Supervisor è¿›ç¨‹é…ç½®æ–‡ä»¶ã€‚ä¸‹é¢å°±æ˜¯å°†è¿™äº›é…ç½®æ–‡ä»¶åº”ç”¨åˆ° Supervisor ä¸­ï¼Œè®© Supervisor æ¥ç®¡ç†è¿™äº›è¿›ç¨‹ã€‚

```bash
sudo supervisorctl reread  # é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶
sudo supervisorctl update  # æ›´æ–°è¿›ç¨‹ç»„
```

æ¥ç€è¿™äº›è¿›ç¨‹ä¼šè¢«è‡ªåŠ¨å¯åŠ¨ï¼Œå¯ä»¥é€šè¿‡ Supervisor æ¥æŸ¥çœ‹è¿™äº›è¿›ç¨‹çš„çŠ¶æ€ï¼š

```bash
> sudo supervisorctl status
backend                          RUNNING   pid 107005, uptime 0:01:23
binlog                           RUNNING   pid 107338, uptime 0:00:04
taskiq                           RUNNING   pid 107339, uptime 0:00:04
```

åˆ†åˆ«æŸ¥çœ‹è¿™ 3 ä¸ªè¿›ç¨‹çš„æ—¥å¿—ï¼š

```bash
> cat backend.err.log
INFO:     2025-12-29 20:52:03,524 - Started server process [107005]
INFO:     2025-12-29 20:52:03,524 - Waiting for application startup.
INFO:     2025-12-29 20:52:03,524 - Creating RabbitMQ connection
INFO:     2025-12-29 20:52:03,535 - Application startup complete.
INFO:     2025-12-29 20:52:03,537 - Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
```

```bash
> cat taskiq.err.log
[2025-12-29 20:53:22,654][taskiq.worker][INFO   ][MainProcess] Pid of a main process: 107339
[2025-12-29 20:53:22,654][taskiq.worker][INFO   ][MainProcess] Starting 2 worker processes.
[2025-12-29 20:53:22,659][taskiq.process-manager][INFO   ][MainProcess] Started process worker-0 with pid 107341
[2025-12-29 20:53:22,661][taskiq.process-manager][INFO   ][MainProcess] Started process worker-1 with pid 107343
[2025-12-29 20:53:23,743][taskiq.receiver.receiver][INFO   ][worker-1] Listening started.
[2025-12-29 20:53:23,874][taskiq.receiver.receiver][INFO   ][worker-0] Listening started.
```

```bash
> cat binlog.err.log
2025-12-29 20:53:23,903 - INFO - å¯åŠ¨æ¶ˆæ¯é˜Ÿåˆ—â€¦â€¦
2025-12-29 20:53:23,911 - INFO - æ­£åœ¨åˆ›å»ºå­çº¿ç¨‹â€¦â€¦
2025-12-29 20:53:23,911 - INFO - è¿æ¥åˆ° MySQL æœåŠ¡å™¨â€¦â€¦
2025-12-29 20:53:23,911 - INFO - connection_settings: {'host': '127.0.0.1', 'port': 3306, 'user': 'root', 'passwd': 'smartoj20250118', 'charset': 'utf8'}
2025-12-29 20:53:23,911 - INFO - resume_stream: True
2025-12-29 20:53:23,911 - INFO - blocking: True
2025-12-29 20:53:23,911 - INFO - only_tables: ['question', 'question_tag', 'tag', 'comment']
2025-12-29 20:53:23,911 - INFO - only_schemas: ['smartoj']
2025-12-29 20:53:23,911 - INFO - enable_logging: True
2025-12-29 20:53:23,911 - INFO - allowed_events_in_packet: frozenset({<class 'pymysqlreplication.row_event.DeleteRowsEvent'>, <class 'pymysqlreplication.event.RotateEvent'>, <class 'pymysqlreplication.row_event.TableMapEvent'>, <class 'pymysqlreplication.row_event.UpdateRowsEvent'>, <class 'pymysqlreplication.row_event.WriteRowsEvent'>})
2025-12-29 20:53:23,912 - INFO - server_id: 101
2025-12-29 20:53:23,912 - INFO - log_pos: 186310
2025-12-29 20:53:23,912 - INFO - log_file: mysql-bin.000001
2025-12-29 20:53:23,912 - INFO - å¼€å§‹ç›‘å¬ binlogâ€¦â€¦
```

ä¸ä¸Šè¿°æ—¥å¿—æ˜¾ç¤ºçš„å†…å®¹åŸºæœ¬ä¸€è‡´ï¼Œåˆ™ä»£è¡¨æ•´ä¸ªåç«¯è¿›ç¨‹å¯åŠ¨æˆåŠŸï¼

> åç«¯æœåŠ¡åº”è¯¥è¯´æ˜¯è¿™ä¸ªé¡¹ç›®ä¸­æœ€å¤æ‚çš„ä¸€éƒ¨åˆ†äº†ï¼ŒæœåŠ¡å¤šã€è¿›ç¨‹ä¹Ÿå¤šã€‚èƒ½é¡ºåˆ©èµ°åˆ°è¿™ä¸€æ­¥å®å±ä¸å®¹æ˜“ğŸ¤—ã€‚
>

## MCP Server éƒ¨ç½²
> ä»£ç ä»“åº“ï¼š[https://github.com/SmartOnlineJudge/smartoj-mcp-server](https://github.com/SmartOnlineJudge/smartoj-mcp-server)ã€‚
>

åœ¨éƒ¨ç½² MCP æœåŠ¡å™¨ä¹‹å‰è¯·å…ˆç¡®ä¿åç«¯å·²ç»éƒ¨ç½²å¥½ï¼Œå¦åˆ™ MCP æœåŠ¡å°†æ— æ³•æ­£å¸¸å¯åŠ¨ã€‚

MCP æœåŠ¡å™¨éƒ¨ç½²æ¯”è¾ƒç®€å•ï¼Œå°†ä»£ç æ‹‰åˆ°æœåŠ¡å™¨ä¸Šé¢ä»¥åï¼Œéœ€è¦å…ˆä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š`settings.py`ã€‚

```python
# æ˜¯å¦æ˜¯å¼€å‘æ¨¡å¼
# è¯¥æ¨¡å¼ä¼šå½±å“é…ç½®æ–‡ä»¶çš„åŠ è½½
DEV_ENV = False
```

å°†è¿™ä¸ªé…ç½®æ”¹æˆ False å³å¯ã€‚

å¦‚æœä½ çš„åç«¯ä¸ MCP æœåŠ¡éƒ¨ç½²åœ¨åŒä¸€å°ä¸»æœºä¸Šé¢ï¼Œé‚£ä¹ˆå¯ä»¥ä¸ç”¨ä¿®æ”¹ .env é…ç½®ä¸­çš„åç«¯åœ°å€ã€‚

æ¥ç€å®‰è£…é¡¹ç›®ä¾èµ–ï¼š

```bash
uv sync
```

å®‰è£…å¥½ä»¥åå°è¯•æ‰‹åŠ¨å¯åŠ¨é¡¹ç›®ï¼š

```bash
uv run main.py
```

å¦‚æœ MinIO å’Œ MCP æœåŠ¡åœ¨åŒä¸€å°ä¸»æœºä¸Šï¼Œé‚£ä¹ˆå½“ä½ ç›´æ¥è¿è¡Œä¸Šé¢çš„å‘½ä»¤ä¼šæŠ¥ç«¯å£å·²ç»è¢«å ç”¨çš„é”™è¯¯ã€‚æ‰€ä»¥éœ€è¦å°†å¯åŠ¨å‡½æ•°çš„ç«¯å£ä¿®æ”¹æˆå…¶ä»–ç«¯å£ï¼Œä¾‹å¦‚ 9002ã€‚

è¾“å‡ºä»¥ä¸‹ç•Œé¢å³å¯è¡¨ç¤º MCP Server å¯åŠ¨æˆåŠŸï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1767014083038-a30853fc-0671-4c0a-838a-48af978ff46c.png)

æ¥ç€ç¼–å†™ä¸€ä¸ª Supervisor é…ç½®ï¼Œè®©å®ƒå¸®æˆ‘ä»¬ç®¡ç†è¿™ä¸ªè¿›ç¨‹ï¼š

```bash
[program:mcp]
command=/path/to/smartoj-mcp-server/.venv/bin/python3 main.py
directory=/path/to/smartoj-mcp-server
user=root
autostart=true
autorestart=true
stderr_logfile=/var/log/smartoj/mcp.err.log  # å…ˆç¡®ä¿ç›®å½•å­˜åœ¨
stdout_logfile=/var/log/smartoj/mcp.out.log  # å…ˆç¡®ä¿ç›®å½•å­˜åœ¨
logfile_maxbytes=5MB
```

æ›´æ–°å¹¶å¯åŠ¨è¿›ç¨‹ï¼š

```bash
sudo supervisorctl reread
sudo supervisorctl update
```

æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼Œå’Œæ‰‹åŠ¨å¯åŠ¨è¾“å‡ºçš„æ—¥å¿—ä¸€è‡´å³ä»£è¡¨ MCP æœåŠ¡éƒ¨ç½²æˆåŠŸï¼

## AI æœåŠ¡éƒ¨ç½²
> ä»£ç ä»“åº“ï¼š[https://github.com/SmartOnlineJudge/smartoj-ai-service](https://github.com/SmartOnlineJudge/smartoj-ai-service)ã€‚
>

åœ¨éƒ¨ç½²è¿™ä¸ªæœåŠ¡ä¹‹å‰ï¼Œéœ€è¦å…ˆç¡®ä¿åç«¯å’Œ MCP æœåŠ¡æ˜¯æ­£å¸¸å¯åŠ¨çš„ã€‚

ç¼–å†™é…ç½®æ–‡ä»¶ï¼Œå…ˆå¤åˆ¶ä¸€ä»½é…ç½®æ–‡ä»¶ï¼š

```bash
cp .env.example .env
```

ç„¶åç¼–å†™ .env æ–‡ä»¶ï¼š

```bash
# AI æœåŠ¡ç›¸å…³é…ç½®
# éœ€è¦ç¬¦åˆ OpenAI æ¥å£çš„è§„èŒƒ
OPENAI_API_KEY=<your api key>
OPENAI_BASE_URL=<your base url>

# Graph Node LLM æ¨¡å‹é…ç½®
# é¢˜ç›®ä¿¡æ¯ç®¡ç† Agent çš„æ¯ä¸ªèŠ‚ç‚¹å¯¹åº”çš„çš„ LLM æ¨¡å‹
QUESTION_MANAGE_DISPATCHER_MODEL=Qwen/Qwen3-8B
QUESTION_MANAGE_MEMORY_TIME_LIMIT_MODEL=deepseek-ai/DeepSeek-V3.1
QUESTION_MANAGE_TEST_MODEL=deepseek-ai/DeepSeek-V3.1
QUESTION_MANAGE_SOLVING_FRAMEWORK_MODEL=deepseek-ai/DeepSeek-V3.1
QUESTION_MANAGE_JUDGE_TEMPLATE_FOR_PYTHON_MODEL=deepseek-ai/DeepSeek-V3.1
QUESTION_MANAGE_PLANNER_MODEL=Qwen/Qwen3-8B
QUESTION_MANAGE_DATA_PREHEAT_MODEL=deepseek-ai/DeepSeek-V3.1
# é€šç”¨ Agent LLM é…ç½®
GENERIC_JSON_PARSER_MODEL=deepseek-ai/DeepSeek-V3.1
GENERIC_CHAT_TITLE_GENERATOR_MODEL=qwen3-30b-a3b
# æ™ºèƒ½åˆ·é¢˜åŠ©æ‰‹ LLM é…ç½®
SOLVING_ASSISTANT_MODEL=deepseek-ai/DeepSeek-V3.1
# ä¸ªæ€§åŒ–è®°å¿† LLM é…ç½®
PERSONALIZED_MEMORY_MODEL=deepseek-ai/DeepSeek-V3.1

# MCP è¿æ¥é…ç½®
MCP_SERVER_URL=http://127.0.0.1:9000/mcp

# åç«¯æ¥å£åœ°å€
BACKEND_URL=http://127.0.0.1:8000

# MySQL URI
DATABASE_URI=mysql://root:password@localhost:3306/smartojai

```

æ¨¡å‹çš„ API éœ€è¦ç¬¦åˆ OpenAI æ ¼å¼ã€‚

å¯¹äºæ¨¡å‹é…ç½®æ–¹é¢ï¼Œä»¥`QUESTION_MANAGE`å¼€å¤´çš„å…¨éƒ¨æ¨¡å‹éƒ½æ¨èä½¿ç”¨ Qwen3-Maxã€‚å› ä¸ºåœ¨å¼€å‘çš„æ—¶å€™ï¼Œè¿™ä¸ªæ¨¡å‹æ˜¯æœ€ç¨³å®šçš„ï¼Œè¾“å‡ºå¾ˆç¬¦åˆé¢„æœŸç»“æœï¼Œä½†æ˜¯å…¶ä»–æ¨¡å‹å°±ä¸ä¸€å®šäº†ã€‚è€Œä»¥`GENERIC`å¼€å¤´çš„æ¨¡å‹æ¨èä½¿ç”¨å‚æ•°ä¸¤è¾ƒå°çš„æ¨¡å‹å³å¯ï¼Œå› ä¸ºä»»åŠ¡è¶³å¤Ÿç®€å•ã€‚è€Œå‰©ä¸‹çš„æ™ºèƒ½åˆ·é¢˜åŠ©æ‰‹ã€ä¸ªæ€§åŒ–è®°å¿†è¿™ä¸¤ä¸ªç”¨ä»€ä¹ˆæ¨¡å‹åŸºæœ¬ä¸Šé—®é¢˜ä¸å¤§ã€‚

MCPã€åç«¯ã€MySQL çš„åœ°å€åœ¨ä¹‹å‰éƒ½å·²ç»éƒ¨ç½²å¥½äº†ï¼Œå°†å®ƒä»¬çš„ä¿¡æ¯å¡«åœ¨é…ç½®æ–‡ä»¶ä¸­å³å¯ã€‚

æ¥ä¸‹æ¥å®‰è£…é¡¹ç›®ä¾èµ–ï¼š

```bash
uv sync
```

æ‰‹åŠ¨å¯åŠ¨é¡¹ç›®ï¼š

```bash
> uv run main.py
INFO:     2025-12-29 21:31:36,829 - Started server process [115855]
INFO:     2025-12-29 21:31:36,829 - Waiting for application startup.
/path/to/smartoj/smartoj-ai-service/.venv/lib/python3.11/site-packages/aiomysql/cursors.py:458: Warning: Table 'checkpoint_migrations' already exists
  await self._do_get_result()
INFO:     2025-12-29 21:31:36,855 - Application startup complete.
INFO:     2025-12-29 21:31:36,855 - Uvicorn running on http://0.0.0.0:8001 (Press CTRL+C to quit)
```

é¦–æ¬¡è¿è¡Œè¯¥é¡¹ç›®çš„æ—¶å€™ï¼Œç¨‹åºä¼šå…ˆåˆ›å»º LangGraph ç›¸å…³çš„æ•°æ®åº“è¡¨ç»“æ„ï¼Œå› æ­¤é€Ÿåº¦å¯èƒ½ä¼šæ¯”è¾ƒæ…¢ä¸€äº›ã€‚

çœ‹åˆ°ä¸Šé¢çš„è¾“å‡ºå°±ä»£è¡¨è¿›ç¨‹å¯ä»¥è¢«æ­£å¸¸å¯åŠ¨ã€‚

æ¥ç€ç¼–å†™ä¸€ä¸ª Supervisor çš„é…ç½®æ–‡ä»¶ï¼š

```bash
[program:ai-service]
command=/path/to/smartoj-ai-service/.venv/bin/python3 main.py
directory=/path/to/smartoj-ai-service
user=root
autostart=true
autorestart=true
stderr_logfile=/var/log/smartoj/ai-service.err.log  # å…ˆç¡®ä¿ç›®å½•å­˜åœ¨
stdout_logfile=/var/log/smartoj/ai-service.out.log  # å…ˆç¡®ä¿ç›®å½•å­˜åœ¨
logfile_maxbytes=5MB
```

å¯åŠ¨è¿›ç¨‹ï¼š

```bash
sudo supervisorctl reread
sudo supervisorctl update
```

æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼Œä¸æ‰‹åŠ¨å¯åŠ¨çš„æ—¥å¿—ç›¸åŒï¼Œå³ä»£è¡¨éƒ¨ç½²æˆåŠŸï¼

è‡³æ­¤ï¼Œæ‰€æœ‰çš„åå°æ¥å£éƒ½å·²ç»éƒ¨ç½²å®Œæ¯•äº†ã€‚ä¸‹é¢å°†éƒ¨ç½²çš„æ˜¯å‰ç«¯ç•Œé¢ã€‚

## å‰ç«¯éƒ¨ç½²
### å®‰è£… Nginx
å®ƒæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ Web æœåŠ¡å™¨ï¼Œç”¨äºåå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡ï¼Œåœ¨è¿™å®ƒä¸»è¦ç”¨äºä»£ç†è®¿é—®å‰ç«¯é¡µé¢ï¼Œä»¥åŠè®©å‰ç«¯é€šè¿‡åå‘ä»£ç†çš„æ–¹å¼æ¥è®¿é—®åç«¯æ¥å£ï¼Œé¿å…å‰ç«¯å‘ç”Ÿè·¨åŸŸé—®é¢˜ã€‚

é€šè¿‡ Linux åŒ…ç®¡ç†å™¨æ¥å®‰è£… Nginxã€‚

å…ˆæ›´æ–°è½¯ä»¶åŒ…ï¼Œå¹¶å‡çº§å®ƒä»¬ï¼š

```bash
sudo apt update
sudo apt upgrade -y
```

å®‰è£…å¿…è¦ä¾èµ–ï¼š

```bash
sudo apt install -y curl gnupg2 ca-certificates lsb-release
```

å®‰è£… Nginxï¼š

```bash
sudo apt install -y nginx
```

å¯åŠ¨ Nginx å¹¶è®¾ç½®å¼€æœºå¯åŠ¨ï¼š

```bash
sudo systemctl start nginx
sudo systemctl enable nginx
```

ç„¶ååœ¨æµè§ˆå™¨ä¸Šç›´æ¥é€šè¿‡å…¬ç½‘ IP è®¿é—®æœåŠ¡å™¨ä¼šæ˜¾ç¤º Nginx è¿”å›çš„å†…å®¹ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1767016398406-e5ac6b6a-5b28-4f83-a916-dd2e6dc1906a.png)

è¿™ä»£è¡¨ Nginx å·²ç»å®‰è£…æˆåŠŸã€‚

### åå°ç®¡ç†ç³»ç»Ÿéƒ¨ç½²
> ä»£ç ä»“åº“ï¼š[https://github.com/SmartOnlineJudge/smartoj-management](https://github.com/SmartOnlineJudge/smartoj-management)ã€‚
>

å¯ä»¥ä¸å°†ä»£ç ä¸‹è½½åˆ°æœåŠ¡å™¨ä¸Šé¢ï¼Œå› ä¸ºè¿™æ ·è¿˜éœ€è¦åœ¨æœåŠ¡ä¸Šå®‰è£… NodeJSï¼Œå¯ä»¥å°†ä»£ç å…ˆä¸‹è½½åˆ°ä¸€å°æœ‰ NodeJS çš„ä¸»æœºä¸Šã€‚

è¿™é‡Œéœ€è¦ç¡®è®¤ä¸€ä¸‹ NodeJS çš„ç‰ˆæœ¬ï¼Œåœ¨å¼€å‘é˜¶æ®µä½¿ç”¨çš„ NodeJS ç‰ˆæœ¬æ˜¯ï¼š`v22.2.0`ã€‚å½“ç„¶å¦‚æœä¸æ˜¯è¿™ä¸ªç‰ˆæœ¬ä¹Ÿå¯èƒ½å¯ä»¥ï¼Œä½†å¦‚æœä¸­é—´å‡ºé—®é¢˜äº†ä¸€èˆ¬éƒ½æ˜¯ NodeJS ç‰ˆæœ¬å¯¼è‡´çš„ã€‚

å°†ä»£ç ä¸‹è½½å®Œæ¯•ä»¥åï¼Œéœ€è¦å…ˆç¼–å†™é…ç½®æ–‡ä»¶ .env.productionï¼š

```bash
# åç«¯æ¥å£åœ°å€
VITE_BACKEND_URL = http://127.0.0.1:8000

# AIæœåŠ¡åç«¯æ¥å£åœ°å€
VITE_AI_SERVICE_BACKEND_URL = http://127.0.0.1:8001

# MinIO åœ°å€
VITE_MINIO_URL = http://127.0.0.1:9000
```

åç«¯åœ°å€å’Œ AI æœåŠ¡åœ°å€æŒ‰è¦æ±‚å¡«å°±å¯ä»¥äº†ï¼Œå¦‚æœåç«¯å’Œ AI æœåŠ¡å’Œå‰ç«¯æ˜¯åœ¨åŒä¸€å°ä¸»æœºä¸Šé¢ï¼Œé‚£é…ç½®å°±ä¸ç”¨æ”¹ã€‚

æ³¨æ„ï¼MinIO åœ°å€ä¸èƒ½ç›´æ¥å¡«å†™åƒ 127.0.0.1 è¿™æ ·çš„å›ç¯åœ°å€ï¼Œå› ä¸ºè¿™ä¸ªåœ°å€æ˜¯ç›´æ¥æ”¾åœ¨ HTML çš„æ ‡ç­¾ä¸­çš„ï¼Œ HTML åŠ è½½å›¾ç‰‡çš„æ—¶å€™æ˜¯ç›´æ¥æŒ‰ç…§è¿™ä¸ª IP æ¥åŠ è½½çš„ï¼Œå¦‚æœä½¿ç”¨å›ç¯åœ°å€ï¼Œé‚£ä¹ˆè¯·æ±‚æ˜¯åˆ°ä¸äº†æœåŠ¡å™¨ä¸Šé¢çš„ï¼Œå¦‚æœè¿™æ ·è®¾ç½®ï¼Œè¯·æ±‚æ˜¯å‘é€åˆ°æµè§ˆå™¨å¯¹åº”çš„ä¸»æœºä¸Šé¢ã€‚æ‰€ä»¥è¿™ä¸ªé…ç½®ä¸€å®šè¦å¡«å†™æœåŠ¡å™¨çš„å…¬ç½‘ IPï¼Œå¹¶åœ¨é˜²ç«å¢™ä¸­æ‰“å¼€ 9000 è¿™ä¸ªç«¯å£ã€‚

å¡«å†™å¥½é…ç½®æ–‡ä»¶ä»¥åï¼Œæ‰§è¡Œæ‰“åŒ…å‘½ä»¤ï¼š

```bash
npm run build
```

å°†æ‰“åŒ…å¥½çš„ç›®å½•`dist`ä¸Šä¼ åˆ°æœåŠ¡ä¸Šã€‚

ç„¶ååœ¨ Nginx çš„é…ç½®æ–‡ä»¶ä¸­ç¼–å†™è®¿é—®å‰ç«¯æ–‡ä»¶çš„ä»£ç†é…ç½®ï¼š

> Nginx çš„é…ç½®æ–‡ä»¶ä¸€èˆ¬å­˜æ”¾åœ¨ /etc/nginx ç›®å½•ä¸‹çš„ nginx.conf æ–‡ä»¶ã€‚
>

```bash
server {
  listen 5173;
  server_name 106.52.180.63;  # æ›¿æ¢ä¸ºä½ çš„åŸŸåæˆ– IP
  
  access_log /var/log/smartoj/smartoj-management-access.log;
  error_log /var/log/smartoj/smartoj-management-error.log;

  # å¤„ç†å‰ç«¯è·¯ç”±ï¼ˆå¦‚ Vue/React çš„ history æ¨¡å¼ï¼‰
  location / {
    alias /path/to/dist/;  # Nginx åº”è¯¥æœ‰æƒé™è®¿é—®è¿™ä¸ªç›®å½•
    try_files $uri $uri/ /index.html;
  }

  # åå‘ä»£ç† API è¯·æ±‚åˆ°åç«¯
  location /api {
    rewrite ^/api/(.*) /$1 break;
    proxy_pass http://127.0.0.1:8000;  # åç«¯åœ°å€
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  location /ai-service {
    rewrite ^/ai-service/(.*) /$1 break;
    proxy_pass http://127.0.0.1:8001;  # AIæœåŠ¡åœ°å€
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  # æµå¼å“åº”é…ç½®
  location /ai-service/chat/stream {
    rewrite ^/ai-service/(.*) /$1 break;
    proxy_pass http://127.0.0.1:8001;

    # å…³é”®ï¼šå…³é—­ä»£ç†ç¼“å†²ï¼Œä»¥æ”¯æŒæµå¼å“åº”
    proxy_buffering off;
    proxy_cache off;

    # è®¾ç½®è¯·æ±‚/å“åº”è¶…æ—¶ï¼ˆæ ¹æ®ä¸šåŠ¡è°ƒæ•´ï¼ŒSSE é•¿è¿æ¥éœ€è¾ƒé•¿ timeoutï¼‰
    proxy_read_timeout 3600s;   # æˆ–æ›´é•¿ï¼Œå¦‚ 24h: 86400s
    proxy_send_timeout 3600s;

    # é€ä¼ å¿…è¦å¤´ä¿¡æ¯
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # ç¦ç”¨ gzip å‹ç¼© SSE æµï¼ˆSSE ä¸åº”è¢«å‹ç¼©ï¼‰
    proxy_set_header Accept-Encoding "";
  }

  # å…¶ä»–ä¼˜åŒ–é…ç½®
  gzip on;
  gzip_types text/plain text/css application/json application/javascript text/xml application/xml image/svg+xml;
}
```

ç„¶åé‡å¯ Nginxï¼š

```bash
sudo nginx -s reload
```

è¿™é‡Œéœ€è¦æ³¨æ„çš„é—®é¢˜æ˜¯ï¼šè¦è®© Nginx æœ‰æƒé™è®¿é—®åˆ°å‰ç«¯çš„æ–‡ä»¶ï¼Œä¸ç„¶æ²¡æœ‰æƒé™è®¿é—®çš„è¯æ˜¯ä¼šæŠ¥é”™çš„ã€‚

è®¿é—®å…¬ç½‘ IP + :5173 ç«¯å£å³å¯çœ‹åˆ°åå°ç®¡ç†ç³»ç»Ÿçš„é¡µé¢ã€‚

### å®¢æˆ·ç«¯éƒ¨ç½²
> ä»£ç ä»“åº“ï¼š[https://github.com/SmartOnlineJudge/smartoj-client](https://github.com/SmartOnlineJudge/smartoj-client)ã€‚
>

ä¸åå°ç®¡ç†ç³»ç»Ÿä¸€æ ·ï¼Œå…ˆä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š

```bash
# åç«¯æ¥å£åœ°å€
VITE_BACKEND_URL = http://127.0.0.1:8000

# AIæœåŠ¡åç«¯æ¥å£åœ°å€
VITE_AI_SERVICE_BACKEND_URL = http://127.0.0.1:8001

# MinIO åœ°å€
VITE_MINIO_URL = http://127.0.0.1:9000

# GitHub å®¢æˆ·ç«¯ ID
VITE_GITHUB_CLIENT_ID = çœŸå®çš„å®¢æˆ·ç«¯ ID

# GitHub æˆæƒå®Œæ¯•åé‡å®šå‘çš„ URI
VITE_GITHUB_REDIRECT_URI = http://localhost:3000/login/oauth/redirect/github
```

MinIO åœ°å€å’Œåå°ç³»ç»Ÿçš„é…ç½®ä¸€è‡´ï¼Œä¸èƒ½å¡«å†™å›ç¯åœ°å€ã€‚

è€Œå¯¹äºä¸‹é¢ä¸¤ä¸ª GitHub é…ç½®ï¼Œåœ¨ç”³è¯· GitHub OAuth APP çš„æ—¶å€™ä¼šæœ‰ï¼Œç›´æ¥å¡«ä¸Šå»å°±è¡Œäº†ã€‚

å¡«å†™å¥½é…ç½®æ–‡ä»¶ä»¥åï¼Œæ‰§è¡Œæ‰“åŒ…å‘½ä»¤ï¼š

```bash
npm run build
```

å°†æ‰“åŒ…å¥½çš„ç›®å½•`dist`ä¸Šä¼ åˆ°æœåŠ¡ä¸Šã€‚

ç„¶ååœ¨ Nginx çš„é…ç½®æ–‡ä»¶ä¸­ç¼–å†™è®¿é—®å‰ç«¯æ–‡ä»¶çš„ä»£ç†é…ç½®ï¼š

```bash
server {
  listen 3000;
  server_name 106.52.180.63;  # æ›¿æ¢ä¸ºä½ çš„åŸŸåæˆ– IP
  
  access_log /var/log/smartoj/smartoj-client-access.log;
  error_log /var/log/smartoj/smartoj-client-error.log;

  # å¤„ç†å‰ç«¯è·¯ç”±ï¼ˆå¦‚ Vue/React çš„ history æ¨¡å¼ï¼‰
  location / {
    alias /path/to/smartoj-client/dist/;
    try_files $uri $uri/ /index.html;
  }

  # åå‘ä»£ç† API è¯·æ±‚åˆ°åç«¯
  location /api {
    rewrite ^/api/(.*) /$1 break;
    proxy_pass http://127.0.0.1:8000;  # åç«¯åœ°å€
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  location /ai-service {
			rewrite ^/ai-service/(.*) /$1 break;
			proxy_pass http://127.0.0.1:8001;  # AIæœåŠ¡åœ°å€
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}

		# æµå¼å“åº”é…ç½®
		location /ai-service/chat/stream {
			rewrite ^/ai-service/(.*) /$1 break;
			proxy_pass http://127.0.0.1:8001;

			# å…³é”®ï¼šå…³é—­ä»£ç†ç¼“å†²ï¼Œä»¥æ”¯æŒæµå¼å“åº”
			proxy_buffering off;
			proxy_cache off;

			# è®¾ç½®è¯·æ±‚/å“åº”è¶…æ—¶ï¼ˆæ ¹æ®ä¸šåŠ¡è°ƒæ•´ï¼ŒSSE é•¿è¿æ¥éœ€è¾ƒé•¿ timeoutï¼‰
			proxy_read_timeout 3600s;   # æˆ–æ›´é•¿ï¼Œå¦‚ 24h: 86400s
			proxy_send_timeout 3600s;

			# é€ä¼ å¿…è¦å¤´ä¿¡æ¯
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;

			# ç¦ç”¨ gzip å‹ç¼© SSE æµï¼ˆSSE ä¸åº”è¢«å‹ç¼©ï¼‰
			proxy_set_header Accept-Encoding "";
		}

  # å…¶ä»–ä¼˜åŒ–é…ç½®
  gzip on;
  gzip_types text/plain text/css application/json application/javascript text/xml application/xml image/svg+xml;
}

```

ç„¶åé‡å¯ Nginxï¼š

```bash
sudo nginx -s reload
```

è¿™é‡Œéœ€è¦æ³¨æ„çš„é—®é¢˜æ˜¯ï¼šè¦è®© Nginx æœ‰æƒé™è®¿é—®åˆ°å‰ç«¯çš„æ–‡ä»¶ï¼Œä¸ç„¶æ²¡æœ‰æƒé™è®¿é—®çš„è¯æ˜¯ä¼šæŠ¥é”™çš„ã€‚

è®¿é—®å…¬ç½‘ IP + :3000 ç«¯å£å³å¯çœ‹åˆ°å®¢æˆ·ç«¯çš„é¡µé¢ã€‚

> åˆ°æ­¤ä¸ºæ­¢ï¼Œæ•´ä¸ªé¡¹ç›®å·²ç»éƒ¨ç½²å®Œæ¯•äº†ï¼Œå„ä¸ªåŠŸèƒ½éƒ½å¯ä»¥æ­£å¸¸è¿è¡Œäº†ğŸ¥³ã€‚å¦‚æœä½ æ²¡æœ‰åŸŸåï¼Œå¹¶ä¸”ä¸æ‰“ç®—è®¾ç½® HTTPS è¯ä¹¦ï¼Œé‚£ä¹ˆé¡¹ç›®çš„éƒ¨ç½²å°±å·²ç»å‘Šä¸€æ®µè½äº†ã€‚
>
> å›é¡¾æ•´ä¸ªéƒ¨ç½²æµç¨‹ï¼Œåº”è¯¥åªæœ‰åç«¯çš„éƒ¨ç½²æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ã€‚å…¶ä»–æ¨¡å—åªè¦é…ç½®ç¼–å†™æ­£ç¡®åŸºæœ¬ä¸Šå°±æ²¡æœ‰ä»€ä¹ˆå¾ˆå¤§çš„é—®é¢˜ã€‚é€šè¿‡å…¬ç½‘ IP + 3000ç«¯å£å³å¯è®¿é—®å®¢æˆ·ç«¯ç•Œé¢ï¼Œé€šè¿‡å…¬ç½‘ IP + 5173 ç«¯å£å³å¯è®¿é—®åå°ç®¡ç†ç•Œé¢ï¼
>
> å½“ç„¶ï¼Œå¦‚æœä½ å¸Œæœ›ä½ çš„ç½‘ç«™èƒ½å¤Ÿæ›´å®¹æ˜“çš„è¢«è®°ä½ï¼Œé‚£ä¹ˆä½ å¯ä»¥å°†ä¸€ä¸ªåŸŸåæ˜ å°„åˆ°æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·å°±ä¸éœ€è¦è®°ä½æœ‰ä¸€å †æ— è§„å¾‹æ•°å­—ç»„æˆçš„ IP äº†ã€‚æœ‰äº†åŸŸåè¿˜ä¸å¤Ÿï¼Œç°åœ¨ç»å¤§å¤šæ•°æµè§ˆå™¨éƒ½ä¼šå¯¹æ²¡æœ‰ HTTPS åŠ å¯†çš„ç½‘ç«™å‘å‡ºè­¦å‘Šï¼Œå½“ç”¨æˆ·é¦–æ¬¡æ‰“å¼€ç½‘ç«™çš„æ—¶å€™ï¼Œä¼šå‡ºç°ä¸€ä¸ªä¸å®Œå…¨çš„è­¦å‘Šï¼Œå› æ­¤é…ç½®ä¸€ä¸ª HTTPS è¯ä¹¦æ˜¯å®Œå…¨å¿…è¦çš„ã€‚
>

## åŸŸåæ˜ å°„
### åŸŸåå‡†å¤‡
é¦–å…ˆä½ éœ€è¦é€šè¿‡å„å¤§åŸŸåæä¾›å‚å•†è´­ä¹°ä¸€ä¸ªåŸŸåã€‚ä¸€èˆ¬åŸŸåçš„æœ‰æ•ˆæœŸéƒ½æ˜¯ 1 å¹´ä»¥ä¸Šã€‚

å¦‚æœä½ çš„åŸŸåæ˜¯åœ¨å›½å†…è´­ä¹°çš„ï¼Œé‚£ä¹ˆè¿˜éœ€è¦åˆ°äº‘æœåŠ¡å™¨çš„å‚å•†è¿›è¡Œå¤‡æ¡ˆï¼Œè¿™ä¸ªæµç¨‹ç§°ä¸ºç®¡å±€å¤‡æ¡ˆã€‚ç®¡å±€å¤‡æ¡ˆå®Œä»¥åè¿˜éœ€è¦åˆ°åŸŸåæŒæœ‰è€…çš„æˆ·å£æ‰€åœ¨åœ°è¿›è¡Œå…¬å®‰å¤‡æ¡ˆã€‚åªæœ‰å½“ä¸Šè¿°ä¸¤ä¸ªå¤‡æ¡ˆå®Œæˆä»¥åï¼Œä½ çš„åŸŸåæ‰èƒ½åœ¨ç½‘ç»œä¸­è¢«æ­£å¸¸è®¿é—®ï¼Œå¦åˆ™å°†ä¼šè¢«è¿è¥å•†æ‹¦æˆªã€‚

> å½“ç„¶ï¼Œå¦‚æœä½ çš„åŸŸåæ˜¯åœ¨å›½å¤–è´­ä¹°çš„ï¼Œå¹¶ä¸”æœåŠ¡å™¨ä¹Ÿæ˜¯å›½å¤–çš„ï¼Œé‚£ä¹ˆå°±å½“ä¸Šé¢çš„è¯æ˜¯ç©ºæ°”ã€‚
>

### DNS è§£æ
åœ¨æœ‰äº†åŸŸåä»¥åï¼Œéœ€è¦å°†åŸŸåçš„ DNS è§£ææŒ‡å‘äº‘æœåŠ¡å™¨çš„åœ°å€ã€‚è¿™æ ·å½“è®¿é—®åŸŸåçš„æ—¶å€™ï¼Œæ‰ä¼šå°†è¯·æ±‚å‘é€åˆ°ä½ çš„æœåŠ¡å™¨ä¸Šï¼Œå¦åˆ™åŸŸåæŒ‡å‘çš„ IP å°†æ˜¯ä¸€ä¸ªç©ºå€¼ã€‚

ç„¶åæˆ‘ä»¬éœ€è¦ä¸ºæ•´ä¸ªé¡¹ç›®æ·»åŠ  3 ä¸ªå­åŸŸåï¼Œå‡è®¾é¡¶çº§åŸŸåæ˜¯ï¼šthcpdd.comï¼Œé‚£ä¹ˆ 3 ä¸ªå­åŸŸååˆ†åˆ«æ˜¯ï¼š

1. smartoj.thcpdd.comï¼šå®¢æˆ·ç«¯è®¿é—®åŸŸå
2. smartojadmin.thcpdd.comï¼šåå°ç®¡ç†ç³»ç»Ÿè®¿é—®åŸŸå
3. smartojoss.thcpdd.comï¼šMinIO è®¿é—®åŸŸå

> æ·»åŠ å­åŸŸåéœ€è¦åœ¨åŸŸåæä¾›å•†çš„æ§åˆ¶å°ä¸­æ·»åŠ ã€‚
>

### MinIO é…ç½®ä¿®æ”¹
ä¹‹å‰è®¿é—® MinIO éƒ½æ˜¯é€šè¿‡ IP + 9000 æ¥è®¿é—®çš„ï¼Œç°åœ¨éœ€è¦ä½¿ç”¨åŸŸåæ¥è®¿é—®è¿™ä¸ªå¯¹è±¡å­˜å‚¨ç³»ç»Ÿã€‚

åœ¨ Nginx é…ç½®ä¸­æ–°å¢ä¸€ä¸ª Server é…ç½®é¡¹ï¼š

```bash
server {
  listen 80;
  server_name smartojoss.thcpdd.com;

  # MinIO ç›¸å…³ä»£ç†é…ç½®
  client_max_body_size 0;  # ç¦ç”¨å®¢æˆ·ç«¯ä¸Šä¼ å¤§å°é™åˆ¶
  chunked_transfer_encoding on;  # æ”¯æŒåˆ†å—ä¼ è¾“

  location / {
    proxy_pass http://127.0.0.1:9000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    
    # MinIO ç‰¹å®šé…ç½®
    proxy_http_version 1.1;
    proxy_set_header Connection "";
    
    # ç¼“å­˜è®¾ç½®
    proxy_buffering off;
    proxy_request_buffering off;
  }
}
```

é‡å¯ Nginxï¼Œè¯•ç€è®¿é—®ç½‘ç«™çš„é»˜è®¤å¤´åƒï¼š[http://smartojoss.thcpdd.com/user-avatars/default.webp](http://smartojoss.thcpdd.com/user-avatars/default.webp)ã€‚

åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä¸Šè¿°åœ°å€ï¼Œå¦‚æœèƒ½å¤Ÿæ­£å¸¸æ˜¾ç¤ºå¤´åƒå³ä»£è¡¨ MinIO åŸŸåæ˜ å°„æˆåŠŸï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1767076147606-0007fc43-85ca-491f-b115-49f7d0424bcf.png)

### å‰ç«¯é…ç½®ä¿®æ”¹
ä¸€åˆ‡å‡†å¤‡å·¥ä½œåšå¥½ä»¥åï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹å‰ç«¯è®¿é—®çš„é…ç½®ã€‚

ä»¥å®¢æˆ·ç«¯ä¸ºä¾‹ï¼Œåœ¨å®¢æˆ·ç«¯çš„ Nginx é…ç½®ä¸­ï¼Œå°† server_name ä¿®æ”¹æˆ`smartoj.thcpdd.com`ã€‚ç„¶åå°†ç›‘å¬çš„ç«¯å£æ”¹æˆ 80ï¼Œå…¶ä»–çš„ Nginx é…ç½®éƒ½ä¸éœ€è¦ä¿®æ”¹ï¼š

```bash
server {
  listen 80;
  server_name smartoj.thcpdd.com;
}
```

æœ€åä¸è¦å¿˜è®°é‡å¯ Nginxã€‚

æ­¤å¤–ï¼Œå®¢æˆ·ç«¯åœ¨ GitHub OAuth2 ç™»å½•çš„æ—¶å€™ï¼Œç™»å½•æˆåŠŸé‡å®šå‘çš„é“¾æ¥ä¹Ÿéœ€è¦æ”¹æˆç›¸åº”çš„åŸŸåã€‚

ä¾‹å¦‚ä¹‹å‰çš„é‡å®šå‘é“¾æ¥æ˜¯ï¼š`http://localhost:3000/login/oauth/redirect/github`ã€‚

è¿™æ—¶éœ€è¦æ›´æ–° GitHub é‡å®šå‘çš„é“¾æ¥ä¸ºï¼š`http://your.domain.com/login/oauth/redirect/github`ã€‚

ç„¶åå°†å‰ç«¯é…ç½®æ–‡ä»¶ä¸­çš„ MinIO åœ°å€é…ç½®ä¹Ÿæ”¹æˆåˆšåˆš MinIO çš„è®¿é—®åŸŸåï¼Œç„¶åé‡æ–°æ‰“åŒ…ä¸€æ¬¡å‰ç«¯æ–‡ä»¶ã€‚

æœ€ç»ˆåº”è¯¥å¯ä»¥é€šè¿‡åŸŸåæ¥è®¿é—®å®¢æˆ·ç«¯äº†ï¼Œå¹¶ä¸”å¤´åƒçš„ URL ä¹Ÿä¼šä½¿ç”¨ MinIO å·²ç»é…ç½®å¥½çš„åŸŸåæ¥è®¿é—®ã€‚

åå°ç®¡ç†ç³»ç»Ÿçš„é…ç½®ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚ä¿®æ”¹ Nginx é…ç½®ï¼Œä¿®æ”¹å‰ç«¯é…ç½®å³å¯ã€‚

## HTTPS æ•°æ®åŠ å¯†ä¼ è¾“
è¿™ä¸€æ­¥çš„é…ç½®å…¶å®å’ŒåŸŸåç›¸å…³ï¼Œå¦‚æœæ²¡æœ‰åŸŸåï¼Œé‚£ä¹ˆè¿™ä¸€æ­¥æ˜¯åšä¸äº†çš„ã€‚

åŠ å¯†è¯ä¹¦æœ‰å¥½çš„ï¼Œä¹Ÿæœ‰åçš„ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒåŠ å¯†è¯ä¹¦éƒ½æ˜¯éœ€è¦ä»˜è´¹çš„ï¼Œå¹¶ä¸”æœ‰æ•ˆæœŸå¾ˆçŸ­ã€‚

ä½†æ˜¯ä¹Ÿæœ‰å…è´¹çš„æ–¹æ¡ˆã€‚ä¾‹å¦‚ Let' s Encryptï¼Œå®ƒæä¾›äº†ä¸€ä¸ªå…è´¹çš„ HTTPS è¯ä¹¦ï¼Œè™½ç„¶æœ‰æ•ˆæœŸåªæœ‰ 3 ä¸ªæœˆï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡æ— é™ç»­æœŸæ¥è¾¾åˆ°â€œæ°¸ä¹…â€çš„æ•ˆæœã€‚

é¦–å…ˆï¼Œå¯ä»¥é€šè¿‡ Python æ¥å®‰è£…ä¸€ä¸ª certbot åº“ï¼Œè¿™ä¸ªåº“æ˜¯ä¸“é—¨ç”¨æ¥ç”³è¯·è¯ä¹¦çš„ï¼š

```bash
uv add certbot
```

æœ‰ 2 ç§ç±»å‹çš„è¯ä¹¦ï¼Œä¸€ç§æ˜¯`*.domain.com`ï¼Œä¸€ç§æ˜¯`domain.com`ã€‚

åœ¨è¿™é‡Œæ²¡æœ‰æ¶‰åŠåˆ°ç¬¬äºŒç§ï¼Œå› æ­¤ç”³è¯·ç¬¬ä¸€ç§æƒ…å†µçš„è¯ä¹¦å°±å¯ä»¥äº†ï¼š

```bash
certbot certonly -d *.domain.com --manual --preferred-challenges dns
```

å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¿è¡Œï¼Œé‚£ä¹ˆä¼šè®©ä½ å¡«å†™é‚®ç®±ã€åŒæ„ç”¨æˆ·åè®®ç­‰ç­‰ï¼ŒæŒ‰ç…§è¦æ±‚å¡«å°±å¯ä»¥äº†ã€‚

æœ€åä¸€æ­¥ä¼šæ˜¾ç¤ºä»¥ä¸‹å†…å®¹ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1767077560898-a2ffec78-1953-4af6-8147-76fae3ee7979.png)

è¿™éœ€è¦ä½ åœ¨åŸŸåæ§åˆ¶å°ä¸­æ·»åŠ ä¸€ä¸ªåä¸º`_acme-challenge`çš„`txt`è®°å½•ç±»å‹ï¼Œå€¼è®¾ç½®ä¸ºï¼š<é©¬èµ›å…‹å†…å®¹>ã€‚è®¾ç½®å®Œæ¯•ä»¥åæŒ‰ä¸‹å›è½¦ã€‚

æœ€åä¼šæ˜¾ç¤ºæˆåŠŸä¿¡æ¯ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1767077705003-4c37d97a-2e46-4377-b560-bbf99ae1bf97.png)

è¿™é‡Œéœ€è¦è®°ä½è¯ä¹¦å’Œç§é’¥çš„ä¿å­˜è·¯å¾„ã€‚

ä¸‹ä¸€æ­¥å°±æ˜¯åœ¨ Nginx ä¸­é…ç½®åŠ å¯†è¯ä¹¦äº†ï¼Œä»¥å®¢æˆ·ç«¯ä¸ºä¾‹ï¼š

```bash
# ä½¿ç”¨httpåè®®è®¿é—®æ—¶è‡ªåŠ¨é‡å®šå‘åˆ°443ç«¯å£
server {
  listen 80;
  server_name smartoj.thcpdd.com;
  rewrite ^(.*)$ https://$host$1 permanent;
}

server {
  listen 443 ssl;  # ç«¯å£è®¾ç½®ä¸º 443
  server_name smartoj.thcpdd.com;

  # é…ç½®è¯ä¹¦è·¯å¾„
  ssl_certificate  /etc/letsencrypt/live/thcpdd.com/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/thcpdd.com/privkey.pem;
}
```

åŒæ ·çš„ï¼Œå¦‚æœå®¢æˆ·ç«¯é…ç½®äº† HTTPSï¼Œé‚£ä¹ˆ MinIO ä¹Ÿå¿…é¡»é…ç½® HTTPSï¼Œå¦‚æœ MinIO æ²¡æœ‰é…ç½® HTTPSï¼Œé‚£ä¹ˆç”¨æˆ·çš„å¤´åƒå°†ä¸èƒ½æ­£å¸¸åŠ è½½ï¼Œå› ä¸ºæµè§ˆå™¨ç¦æ­¢ HTTPS çš„ç½‘ç«™å‘ HTTP çš„åœ°å€å‘é€è¯·æ±‚ã€‚

ç„¶å GitHub OAuth2 çš„é‡å®šå‘åœ°å€ä¹Ÿè¦å°†`http`æ”¹æˆ`https`ã€‚

é‡å¯ Nginx é…ç½®ï¼Œé‡æ–°æ‰“åŒ…å‰ç«¯æ–‡ä»¶ï¼Œæœ€åè®¿é—®é¡µé¢ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/47866636/1767078584171-710a6f63-82ac-462f-8e02-c2f9a86a7ff2.png)

